
  <!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    
    <title>svGPFA.plot.plotUtilsPlotly | svGPFA 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/theme.39dcd091ff2d4f33bf46.css" />
    <link rel="stylesheet" href="../../../_static/proof.css" />
    <link rel="stylesheet" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
  </head>

  <body class="antialiased text-gray scroll-smooth">
    <div
      id="page"
      data-controller="sidebar search "
      data-action="keydown@window->search#focus "
      class="min-h-screen xl:h-screen flex flex-col xl:grid xl:grid-layout print:block print:h-auto"
    >
      <a class="block transition -translate-x-full focus:translate-x-0 opacity-0 focus:opacity-100 text-xl bg-white p-4 z-20 absolute top-0 left-0 h-14" href="#svgpfa-plot-plotutilsplotly" title="Skip navigation links">Skip to content</a>

      <header class="grid-area-header z-10 h-14 fixed w-full top-0 print:hidden">
        <div class="bg-gray-dark shadow-md flex items-center h-full xl:px-2 relative"><div class="flex items-center">
      <button
    data-action="sidebar#open"
    data-sidebar-target="hamburger"
    class="xl:hidden h-14 w-14 leading-14 text-gray-100 hover:bg-gray-700 hover:text-brand focus:outline-none focus:bg-gray-700 focus:text-brand">
  <span class="sr-only">Open navigation menu</span>
  <svg aria-hidden="true" class="fill-current h-8 w-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</button><a class="hover:bg-gray-700 focus:bg-gray-700 focus:outline-none"
   href="../../../index.html"
   title="Back to homepage"><span class="hidden lg:inline-block shrink-0 font-medium text-gray-100 mx-5 leading-14 tracking-wider">svGPFA 0.0.1 documentation</span>
</a></div><div class="flex justify-end items-center flex-1"><form
  id="searchbox"
  action="../../../search.html"
  data-action="click->search#focusSearchInput"
  method="get"
  class="flex print:hidden justify-between items-center leading-14 md:ml-4 bg-gray-dark text-gray-300 focus-within:bg-gray-50 focus-within:text-gray-800 focus-within:absolute focus-within:inset-x-0 focus-within:top-0 md:focus-within:w-full md:focus-within:static z-10">

  <button
    class="text-inherit h-14 w-14"
    aria-label="Get search results"
    tabindex="-1"
  >
    <svg aria-hidden="true" class="fill-current stroke-current h-8 w-8" stroke-width="0.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
  </button>

  <input
    name="q"
    id="search-input"
    data-search-target="searchInput"
    type="search"
    aria-label="Search the docs"
    placeholder="Search the docs"
    class="pr-2 bg-transparent text-inherit focus:outline-none w-0 md:w-auto focus:w-full transition-all duration-100"
  />
</form></div>
</div>
      </header>

      
<aside data-sidebar-target="sidebar" class="grid-area-sidebar h-full fixed pt-14 xl:relative inset-y-0 left-0 z-20 xl:z-0 print:hidden overflow-y-auto transition-all transform transform-gpu -translate-x-full opacity-0 duration-300 xl:translate-x-0 xl:opacity-100">
  <nav
  role="navigation"
  class="h-full overflow-y-auto bg-white text-gray-600 pt-8 flex flex-col"
>
  <div class="nav-toc flex-1 pl-6"><p class="caption" role="heading"><span class="caption-text">General notes:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../highLevelInterface.html">2. High-level interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../lowLevelInterface.html">3. Low-level interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/index.html">4. Scripts for estimation and visualization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../auto_examples/plot_simulation.html">4.1. Simulated data and default params</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../auto_examples/plot_simulation.html#estimate-model">4.1.1. Estimate model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../auto_examples/plot_simulation.html#goodness-of-fit-gof">4.1.2. Goodness of fit (GOF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../auto_examples/plot_simulation.html#plotting">4.1.3. Plotting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../auto_examples/plot_striatum_ibl.html">4.2. IBLâ€™s Recordings from the striatum of a mouse performing a visual discrimination task</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../auto_examples/plot_striatum_ibl.html#setup-environment">4.2.1. 1. Setup environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../auto_examples/plot_striatum_ibl.html#epoch">4.2.2. 2. Epoch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../auto_examples/plot_striatum_ibl.html#get-parameters">4.2.3. 3. Get parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../auto_examples/plot_striatum_ibl.html#estimate-svgpfa-model">4.2.4. 4. Estimate svGPFA model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../auto_examples/plot_striatum_ibl.html#goodness-of-fit-analysis">4.2.5. 5. Goodness-of-fit analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../auto_examples/plot_striatum_ibl.html#plotting">4.2.6. 6. Plotting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../auto_examples/plot_GPe.html">4.3. Basal ganglia recordings from a mouse performing a bandit task</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../auto_examples/plot_GPe.html#estimate-model">4.3.1. Estimate model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../auto_examples/plot_GPe.html#goodness-of-fit-gof">4.3.2. Goodness of fit (GOF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../auto_examples/plot_GPe.html#plotting">4.3.3. Plotting</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced notes:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../dataStructures.html">1. Data structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../objectOrientedDesign.html">2. Object-oriented design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../implementationNotes.html">3. Implementation notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../derivations.html">4. Derivations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../derivations.html#gpfa-model">4.1. GPFA model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../derivations.html#gpfa-with-inducing-points-model">4.2. GPFA with inducing points model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../derivations.html#svgpfa-variational-lower-bound">4.3. svGPFA variational lower bound</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../derivations.html#variational-distribution-of-h-nr-cdot">4.4. Variational distribution of <span class="math notranslate nohighlight">\(h_{nr}(\cdot)\)</span></a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../params.html">1. Parameters and their specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../params.html#data-structure-parameters">1.1. Data structure parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../params.html#trial-specific-format">1.1.1. Trial-specific format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../params.html#trial-common-format">1.1.2. Trial-common format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../params.html#defaults">1.1.3. Defaults</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../params.html#initial-values-of-model-parameters">1.2. Initial values of model parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../params.html#variational-parameters">1.2.1. Variational parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../params.html#embedding-parameters">1.2.2. Embedding parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../params.html#kernel-parameters">1.2.3. Kernel parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../params.html#inducing-points-locations-parameters">1.2.4. Inducing points locations parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../params.html#optimisation-parameters">1.3. Optimisation parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../params.html#id20">1.3.1. Defaults</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">2. References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../svGPFA.html">1. svGPFA package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../svGPFA.html#subpackages">1.1. Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../svGPFA.plot.html">1.1.1. svGPFA.plot package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../svGPFA.simulations.html">1.1.2. svGPFA.simulations package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../svGPFA.stats.html">1.1.3. svGPFA.stats package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../svGPFA.utils.html">1.1.4. svGPFA.utils package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../svGPFA.html#module-svGPFA">1.2. Module contents</a></li>
</ul>
</li>
</ul>
</div>

  <button
      data-action="sidebar#close"
      title="Close navigation menu"
      class="text-4xl text-gray-800 p-4 bottom-0 hover:text-brand xl:hidden focus:text-brand self-center">
    <span class="sr-only">Close navigation menu</span>
    <svg aria-hidden="true" class="fill-current stroke-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
  </button>
</nav>
</aside>

<main
  class="px-4 pt-14 xl:ml-fluid grid-area-main overflow-y-auto flex flex-col flex-1 h-full mx-0 md:mx-auto xl:mr-0"
><nav role="navigation"
     aria-label="breadcrumbs"
     class="print:hidden mt-12 text-sm text-gray-light">
  <a class="text-gray-light text-sm hover:text-gray-dark font-medium focus:text-gray-dark" href="../../../index.html">svGPFA 0.0.1 documentation</a>
  <span class="mr-1">/</span><a class="text-gray-light text-sm hover:text-gray-dark" href="../../index.html">Module code</a>
    <span class="mr-1">/</span><span aria-current="page">svGPFA.plot.plotUtilsPlotly</span>
</nav>
  <article role="main" class="flex-1">
    
  <h1>Source code for svGPFA.plot.plotUtilsPlotly</h1><div class="highlight"><pre>
<span></span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="c1"># import matplotlib.pyplot as plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">plotly.subplots</span>
<span class="kn">import</span> <span class="nn">plotly</span>
<span class="c1"># import plotly.io as pio</span>
<span class="c1"># import plotly.express as px</span>

<span class="kn">import</span> <span class="nn">svGPFA.utils.miscUtils</span>
<span class="kn">import</span> <span class="nn">gcnu_common.utils.neural_data_analysis</span>


<span class="c1"># spike rates and times</span>
<div class="viewcode-block" id="getPlotSpikesRatesAllTrialsAllNeurons"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotSpikesRatesAllTrialsAllNeurons">[docs]</a><span class="k">def</span> <span class="nf">getPlotSpikesRatesAllTrialsAllNeurons</span><span class="p">(</span>
        <span class="n">spikes_rates</span><span class="p">,</span> <span class="n">trials_ids</span><span class="p">,</span> <span class="n">clusters_ids</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Neuron Index&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Average Spike Rate (Hz)&quot;</span><span class="p">):</span>

    <span class="n">n_neurons</span> <span class="o">=</span> <span class="n">spikes_rates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">neurons_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_neurons</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">trial_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">):</span>
        <span class="n">hover_text</span> <span class="o">=</span> \
            <span class="p">[</span><span class="s2">&quot;Cluster ID: </span><span class="si">{:02d}</span><span class="s2">&lt;br&gt;Trial ID: </span><span class="si">{:f}</span><span class="s2">&lt;br&gt;Spike Rate: </span><span class="si">{:f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">cluster_id</span><span class="p">,</span> <span class="n">trial_id</span><span class="p">,</span> <span class="n">spikes_rates</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters_ids</span><span class="p">)]</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">neurons_indices</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spikes_rates</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:],</span>
                           <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trial_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getSimulatedSpikesTimesPlotMultipleTrials"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getSimulatedSpikesTimesPlotMultipleTrials">[docs]</a><span class="k">def</span> <span class="nf">getSimulatedSpikesTimesPlotMultipleTrials</span><span class="p">(</span><span class="n">spikesTimes</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span>
                                              <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Neuron&quot;</span><span class="p">,</span>
                                              <span class="n">titlePattern</span><span class="o">=</span><span class="s2">&quot;Trial </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikesTimes</span><span class="p">)</span>
    <span class="n">subplotsTitles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;trial=</span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">)]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">subplots</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                        <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shared_yaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">subplot_titles</span><span class="o">=</span><span class="n">subplotsTitles</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spikesTimes</span><span class="p">[</span><span class="n">r</span><span class="p">])):</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">spikesTimes</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spikesTimes</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">n</span><span class="p">])),</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="c1"># hoverinfo=&quot;skip&quot;,</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="n">n_trials</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n_trials</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;plot_bgcolor&quot;</span><span class="p">:</span> <span class="s2">&quot;rgba(0, 0, 0, 0)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;paper_bgcolor&quot;</span><span class="p">:</span> <span class="s2">&quot;rgba(0, 0, 0, 0)&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getSpikesTimesPlotOneTrial"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getSpikesTimesPlotOneTrial">[docs]</a><span class="k">def</span> <span class="nf">getSpikesTimesPlotOneTrial</span><span class="p">(</span><span class="n">spikes_times</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                               <span class="n">align_event_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">marked_events</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Neuron&quot;</span><span class="p">,</span>
                               <span class="n">event_line_color</span><span class="o">=</span><span class="s2">&quot;rgba(0, 0, 255, 0.2)&quot;</span><span class="p">,</span>
                               <span class="n">event_line_width</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">nNeurons</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikes_times</span><span class="p">)</span>
    <span class="n">min_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">Inf</span>
    <span class="n">max_time</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">Inf</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nNeurons</span><span class="p">):</span>
        <span class="c1"># workaround because if a trial contains only one spike spikes_times[n]</span>
        <span class="c1"># does not respond to the len function</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikes_times</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">spikes_times</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">spikes_times</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">min_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
            <span class="n">max_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_time</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="c1"># hoverinfo=&quot;skip&quot;,</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">marked_events</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">align_event_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_marked_events</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">marked_events</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_marked_events</span><span class="p">):</span>
            <span class="n">marked_time</span> <span class="o">=</span> <span class="n">marked_events</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">align_event_times</span>
            <span class="k">if</span> <span class="n">marked_time</span> <span class="o">&gt;</span> <span class="n">max_time</span><span class="p">:</span>
                <span class="n">marked_time</span> <span class="o">=</span> <span class="n">max_time</span>
            <span class="k">if</span> <span class="n">marked_time</span> <span class="o">&lt;</span> <span class="n">min_time</span><span class="p">:</span>
                <span class="n">marked_time</span> <span class="o">=</span> <span class="n">min_time</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">marked_time</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">event_line_color</span><span class="p">,</span>
                                                   <span class="n">width</span><span class="o">=</span><span class="n">event_line_width</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;plot_bgcolor&quot;</span><span class="p">:</span> <span class="s2">&quot;rgba(0, 0, 0, 0)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;paper_bgcolor&quot;</span><span class="p">:</span> <span class="s2">&quot;rgba(0, 0, 0, 0)&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getSpikesTimesPlotOneNeuron"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getSpikesTimesPlotOneNeuron">[docs]</a><span class="k">def</span> <span class="nf">getSpikesTimesPlotOneNeuron</span><span class="p">(</span><span class="n">spikes_times</span><span class="p">,</span>
                                <span class="n">neuron_index</span><span class="p">,</span>
                                <span class="n">sorting_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="n">trials_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">marked_events_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">marked_events_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">marked_events_markers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">align_event_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">trials_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_trial_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                <span class="n">marked_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">spikes_symbol</span><span class="o">=</span><span class="s2">&quot;line-ns-open&quot;</span><span class="p">,</span>
                                <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Trial&quot;</span><span class="p">,</span>
                                <span class="n">event_line_color</span><span class="o">=</span><span class="s2">&quot;rgba(0, 0, 255, 0.2)&quot;</span><span class="p">,</span>
                                <span class="n">event_line_width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">spikes_marker_size</span><span class="o">=</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikes_times</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trials_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">trials_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_trials</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sorting_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argsort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sorting_times</span><span class="p">)</span>
        <span class="n">spikes_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">spikes_times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">argsort</span><span class="p">]</span>
        <span class="n">sorting_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">sorting_times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">argsort</span><span class="p">]</span>
        <span class="n">trials_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">argsort</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">marked_events_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">marked_events_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">marked_events_times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">argsort</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">marked_events_colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">marked_events_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">marked_events_colors</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">argsort</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">marked_events_markers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">marked_events_markers</span> <span class="o">=</span> <span class="p">[</span><span class="n">marked_events_markers</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">argsort</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">align_event_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">align_event_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">align_event_times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">argsort</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">trials_colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trials_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">trials_colors</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">argsort</span><span class="p">]</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikes_times</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="n">spikes_times_trial_neuron</span> <span class="o">=</span> <span class="n">spikes_times</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">neuron_index</span><span class="p">]</span>
        <span class="c1"># workaround because if a trial contains only one spike spikes_times[n]</span>
        <span class="c1"># does not respond to the len function</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikes_times_trial_neuron</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">spikes_times_trial_neuron</span> <span class="o">=</span> <span class="p">[</span><span class="n">spikes_times_trial_neuron</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">trials_colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spikes_color</span> <span class="o">=</span> <span class="n">trials_colors</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spikes_color</span> <span class="o">=</span> <span class="n">default_trial_color</span>
        <span class="n">trial_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">spikes_times_trial_neuron</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spikes_times_trial_neuron</span><span class="p">)),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">spikes_marker_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">spikes_color</span><span class="p">,</span>
                        <span class="n">symbol</span><span class="o">=</span><span class="n">spikes_symbol</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trial </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trial_label</span><span class="p">),</span>
            <span class="n">legendgroup</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;trial</span><span class="si">{</span><span class="n">trial_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="n">trial_label</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">spikes_times_trial_neuron</span><span class="p">),</span>
            <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;Time %</span><span class="si">{x}</span><span class="s2">&lt;br&gt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;Trial %</span><span class="si">{text}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">marked_events_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">marked_events_times_centered</span> <span class="o">=</span> <span class="n">marked_events_times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">-</span><span class="n">align_event_times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
            <span class="n">n_marked_events</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">marked_events_times</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_marked_events</span><span class="p">):</span>
                <span class="n">trace_marker</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">marked_events_times_centered</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                                          <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">],</span>
                                          <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">marked_events_colors</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                                      <span class="n">symbol</span><span class="o">=</span><span class="n">marked_events_markers</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                                      <span class="n">size</span><span class="o">=</span><span class="n">marked_size</span><span class="p">),</span>
                                          <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trial </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trial_label</span><span class="p">),</span>
                                          <span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="n">trial_label</span><span class="p">],</span>
                                          <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;Time %</span><span class="si">{x}</span><span class="s2">&lt;br&gt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;Trial %</span><span class="si">{text}</span><span class="s2">&quot;</span><span class="p">,</span>
                                          <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span>
                                          <span class="n">legendgroup</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;trial</span><span class="si">{</span><span class="n">trial_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                          <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_marker</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;plot_bgcolor&quot;</span><span class="p">:</span> <span class="s2">&quot;rgba(0, 0, 0, 0)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;paper_bgcolor&quot;</span><span class="p">:</span> <span class="s2">&quot;rgba(0, 0, 0, 0)&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<span class="c1"># embedding</span>
<div class="viewcode-block" id="getPlotTrueAndEstimatedEmbeddingParams"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedEmbeddingParams">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedEmbeddingParams</span><span class="p">(</span><span class="n">trueC</span><span class="p">,</span> <span class="n">trueD</span><span class="p">,</span>
                                           <span class="n">estimatedC</span><span class="p">,</span> <span class="n">estimatedD</span><span class="p">,</span>
                                           <span class="n">linestyleTrue</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
                                           <span class="n">linestyleEstimated</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
                                           <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;asterisk&quot;</span><span class="p">,</span>
                                           <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Neuron Index&quot;</span><span class="p">,</span>
                                           <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Coefficient Value&quot;</span><span class="p">):</span>
    <span class="n">figDic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;layout&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;xaxis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">xlabel</span><span class="p">},</span>
            <span class="s2">&quot;yaxis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">ylabel</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">neuronIndices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">trueC</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">estimatedC</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;true C[</span><span class="si">{:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">neuronIndices</span><span class="p">,</span>
                <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">trueC</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;dash&quot;</span><span class="p">:</span> <span class="n">linestyleTrue</span><span class="p">},</span>
                <span class="c1"># &quot;marker_symbol&quot;: marker,</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;estimated C[</span><span class="si">{:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">neuronIndices</span><span class="p">,</span>
                <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">estimatedC</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;dash&quot;</span><span class="p">:</span> <span class="n">linestyleEstimated</span><span class="p">},</span>
                <span class="c1"># &quot;marker_symbol&quot;: marker,</span>
            <span class="p">},</span>
        <span class="p">)</span>
    <span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;true d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">neuronIndices</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">trueD</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;dash&quot;</span><span class="p">:</span> <span class="n">linestyleTrue</span><span class="p">},</span>
            <span class="c1"># &quot;marker_symbol&quot;: marker,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;estimated d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">neuronIndices</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">estimatedD</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;dash&quot;</span><span class="p">:</span> <span class="n">linestyleEstimated</span><span class="p">},</span>
            <span class="c1"># &quot;marker_symbol&quot;: marker,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># import pdb; pdb.set_trace()</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotEmbeddingParams"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotEmbeddingParams">[docs]</a><span class="k">def</span> <span class="nf">getPlotEmbeddingParams</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;asterisk&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Neuron Index&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">):</span>
    <span class="n">figDic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;layout&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;xaxis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">xlabel</span><span class="p">},</span>
            <span class="s2">&quot;yaxis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">ylabel</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">neuronIndices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;C[:,</span><span class="si">{:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">neuronIndices</span><span class="p">,</span>
                <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">C</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;dash&quot;</span><span class="p">:</span> <span class="n">linestyle</span><span class="p">},</span>
                <span class="c1"># &quot;marker_symbol&quot;: marker,</span>
            <span class="p">},</span>
        <span class="p">)</span>
    <span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">neuronIndices</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;dash&quot;</span><span class="p">:</span> <span class="n">linestyle</span><span class="p">},</span>
            <span class="c1"># &quot;marker_symbol&quot;: marker,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># import pdb; pdb.set_trace()</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getPlotOrthonormalizedEmbeddingParams"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotOrthonormalizedEmbeddingParams">[docs]</a><span class="k">def</span> <span class="nf">getPlotOrthonormalizedEmbeddingParams</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;asterisk&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Neuron Index&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">):</span>
    <span class="n">nNeurons</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nLatents</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Vh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
    <span class="n">neuronIndices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nNeurons</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">neuronIndices</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">U</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;U[:,</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dash&quot;</span><span class="p">:</span> <span class="n">linestyle</span><span class="p">},</span>
                           <span class="c1"># marker_symbol=marker,</span>
                           <span class="n">hovertemplate</span><span class="o">=</span><span class="n">hovertemplate</span><span class="p">,</span>
                           <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">neuronIndices</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                       <span class="n">name</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dash&quot;</span><span class="p">:</span> <span class="n">linestyle</span><span class="p">},</span>
                       <span class="c1"># marker_symbol=marker,</span>
                       <span class="n">hovertemplate</span><span class="o">=</span><span class="n">hovertemplate</span><span class="p">,</span>
                       <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getPlotEmbeddingAcrossTrials"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotEmbeddingAcrossTrials">[docs]</a><span class="k">def</span> <span class="nf">getPlotEmbeddingAcrossTrials</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">embeddingsMeans</span><span class="p">,</span> <span class="n">embeddingsSTDs</span><span class="p">,</span>
                                 <span class="n">cbAlpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                 <span class="n">indPointsLocsColor</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,0.5)&quot;</span><span class="p">,</span>
                                 <span class="n">trials_colors_patterns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">default_trial_color_pattern</span><span class="o">=</span><span class="s2">&quot;rgba(128,128,128,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                                 <span class="n">cb_transparency</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">mean_transparency</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                 <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (msec)&quot;</span><span class="p">,</span>
                                 <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span>
                                 <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="c1"># times = times.detach().numpy()</span>
    <span class="c1"># embeddingsMeans = embeddingsMeans.detach().numpy()</span>
    <span class="c1"># embeddingsSTDs = embeddingsSTDs.detach().numpy()</span>

    <span class="c1"># pio.renderers.default = &quot;browser&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="n">embeddingsMeans</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="n">trial_times</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">meanToPlot</span> <span class="o">=</span> <span class="n">embeddingsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">stdToPlot</span> <span class="o">=</span> <span class="n">embeddingsSTDs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">ciToPlot</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">stdToPlot</span>
        <span class="k">if</span> <span class="n">trials_colors_patterns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trial_color_pattern</span> <span class="o">=</span> <span class="n">trials_colors_patterns</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trial_color_pattern</span> <span class="o">=</span> <span class="n">default_trial_color_pattern</span>

        <span class="c1"># pdb.set_trace()</span>
<span class="c1">#         import matplotlib</span>
<span class="c1">#         matplotlib.use(&#39;TkAgg&#39;)</span>
<span class="c1">#         import matplotlib.pyplot as plt</span>
<span class="c1">#         plt.plot(times, meanToPlot)</span>
<span class="c1">#         plt.show()</span>
<span class="c1">#         pdb.set_trace()</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">trial_times</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">meanToPlot</span>
        <span class="n">y_upper</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">ciToPlot</span>
        <span class="n">y_lower</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">ciToPlot</span>

        <span class="n">traceCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">y_upper</span><span class="p">,</span> <span class="n">y_lower</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="n">trial_color_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cb_transparency</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">trial_color_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="c1"># name=&quot;trial CB {:d}&quot;.format(r),</span>
            <span class="n">legendgroup</span><span class="o">=</span><span class="s2">&quot;trial</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">traceMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">trial_color_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean_transparency</span><span class="p">)),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trial </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
            <span class="n">legendgroup</span><span class="o">=</span><span class="s2">&quot;trial</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceCB</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceMean</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getSimulatedEmbeddingPlot"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getSimulatedEmbeddingPlot">[docs]</a><span class="k">def</span> <span class="nf">getSimulatedEmbeddingPlot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> 
                              <span class="n">cbAlpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> 
                              <span class="n">cbFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,255,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span> 
                              <span class="n">samplesLineColor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
                              <span class="n">meanLineColor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> 
                              <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span> 
                              <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Embedding&quot;</span><span class="p">):</span>
    <span class="c1"># tSamples[r], tMeans[r], tSTDs[r],</span>
    <span class="c1"># eMean[r], eSTDs[r] \in nNeurons x nSamples</span>
    <span class="c1"># pio.renderers.default = &quot;browser&quot;</span>
    <span class="c1">#</span>
    <span class="n">ci</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">stds</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">times</span>
    <span class="n">x_rev</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">yMeans</span> <span class="o">=</span> <span class="n">means</span>
    <span class="n">ySamples</span> <span class="o">=</span> <span class="n">samples</span>
    <span class="n">yMeans_upper</span> <span class="o">=</span> <span class="n">yMeans</span> <span class="o">+</span> <span class="n">ci</span>
    <span class="n">yMeans_lower</span> <span class="o">=</span> <span class="n">yMeans</span> <span class="o">-</span> <span class="n">ci</span>
    <span class="n">yMeans_lower</span> <span class="o">=</span> <span class="n">yMeans_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yMeans</span> <span class="o">=</span> <span class="n">yMeans</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">ySamples</span> <span class="o">=</span> <span class="n">ySamples</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yMeans_upper</span> <span class="o">=</span> <span class="n">yMeans_upper</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yMeans_lower</span> <span class="o">=</span> <span class="n">yMeans_lower</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">traceCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">x_rev</span><span class="p">)),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yMeans_upper</span><span class="p">,</span> <span class="n">yMeans_lower</span><span class="p">)),</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="n">cbFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cbAlpha</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yMeans</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">meanLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mean&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceSamples</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">ySamples</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">samplesLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Sample&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceCB</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceSamples</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotTrueAndEstimatedEmbedding"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedEmbedding">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedEmbedding</span><span class="p">(</span><span class="n">tTimes</span><span class="p">,</span> <span class="n">tSamples</span><span class="p">,</span> <span class="n">tMeans</span><span class="p">,</span> <span class="n">tSTDs</span><span class="p">,</span>
                                     <span class="n">eTimes</span><span class="p">,</span> <span class="n">eMeans</span><span class="p">,</span> <span class="n">eSTDs</span><span class="p">,</span>
                                     <span class="n">CBalpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
                                     <span class="n">tCBFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,255,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                                     <span class="n">tSamplesLineColor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                     <span class="n">tMeanLineColor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                     <span class="n">eCBFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                                     <span class="n">eMeanLineColor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                     <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span>
                                     <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Embedding&quot;</span><span class="p">,</span>
                                     <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="c1"># tSamples[r], tMeans[r], tSTDs[r],</span>
    <span class="c1"># eMean[r], eSTDs[r] \in nNeurons x nSamples</span>
    <span class="c1"># pio.renderers.default = &quot;browser&quot;</span>
    <span class="c1">#</span>
    <span class="n">eCI</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">eSTDs</span>
    <span class="n">xE</span> <span class="o">=</span> <span class="n">eTimes</span>
    <span class="n">xE_rev</span> <span class="o">=</span> <span class="n">xE</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">yE</span> <span class="o">=</span> <span class="n">eMeans</span>
    <span class="n">yE_upper</span> <span class="o">=</span> <span class="n">yE</span> <span class="o">+</span> <span class="n">eCI</span>
    <span class="n">yE_lower</span> <span class="o">=</span> <span class="n">yE</span> <span class="o">-</span> <span class="n">eCI</span>
    <span class="n">yE_lower</span> <span class="o">=</span> <span class="n">yE_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">xE</span> <span class="o">=</span> <span class="n">xE</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yE</span> <span class="o">=</span> <span class="n">yE</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yE_upper</span> <span class="o">=</span> <span class="n">yE_upper</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yE_lower</span> <span class="o">=</span> <span class="n">yE_lower</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">tCI</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">tSTDs</span>
    <span class="n">xT</span> <span class="o">=</span> <span class="n">tTimes</span>
    <span class="n">xT_rev</span> <span class="o">=</span> <span class="n">xT</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">yTMeans</span> <span class="o">=</span> <span class="n">tMeans</span>
    <span class="n">yTSamples</span> <span class="o">=</span> <span class="n">tSamples</span>
    <span class="n">yTMeans_upper</span> <span class="o">=</span> <span class="n">yTMeans</span> <span class="o">+</span> <span class="n">tCI</span>
    <span class="n">yTMeans_lower</span> <span class="o">=</span> <span class="n">yTMeans</span> <span class="o">-</span> <span class="n">tCI</span>
    <span class="n">yTMeans_lower</span> <span class="o">=</span> <span class="n">yTMeans_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">xT</span> <span class="o">=</span> <span class="n">xT</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yTMeans</span> <span class="o">=</span> <span class="n">yTMeans</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yTSamples</span> <span class="o">=</span> <span class="n">yTSamples</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yTMeans_upper</span> <span class="o">=</span> <span class="n">yTMeans_upper</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yTMeans_lower</span> <span class="o">=</span> <span class="n">yTMeans_lower</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">traceECB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xE</span><span class="p">,</span> <span class="n">xE_rev</span><span class="p">)),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yE_upper</span><span class="p">,</span> <span class="n">yE_lower</span><span class="p">)),</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="n">eCBFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CBalpha</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceEMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xE</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yE</span><span class="p">,</span>
        <span class="c1"># line=dict(color=&quot;rgb(0,100,80)&quot;),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">eMeanLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Estimated Mean&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceTCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xT</span><span class="p">,</span> <span class="n">xT_rev</span><span class="p">)),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yTMeans_upper</span><span class="p">,</span> <span class="n">yTMeans_lower</span><span class="p">)),</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="n">tCBFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CBalpha</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceTMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xT</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yTMeans</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">tMeanLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True Mean&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceTSamples</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xT</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yTSamples</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">tSamplesLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True Sample&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceECB</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceEMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTCB</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTSamples</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotMean"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotMean">[docs]</a><span class="k">def</span> <span class="nf">getPlotMean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                      <span class="n">mean_line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">mean_width</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c1"># inputs are numpy arrays</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">mean</span>

    <span class="n">traceMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="c1"># line=dict(color=&quot;rgb(0,100,80)&quot;),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">mean_line_color</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">mean_width</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="c1"># import pdb; pdb.set_trace()</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotMeanWithCI"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotMeanWithCI">[docs]</a><span class="k">def</span> <span class="nf">getPlotMeanWithCI</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">CBalpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                      <span class="n">cbFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                      <span class="n">meanLineColor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">):</span>
    <span class="c1"># inputs are numpy arrays</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">mean</span>
    <span class="n">y_lower</span> <span class="o">=</span> <span class="n">ci</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y_upper</span> <span class="o">=</span> <span class="n">ci</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">traceCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">y_upper</span><span class="p">,</span> <span class="n">y_lower</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]),</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="n">cbFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CBalpha</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="c1"># line=dict(color=&quot;rgb(0,100,80)&quot;),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">meanLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceCB</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="c1"># import pdb; pdb.set_trace()</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotTrueAndEstimatedEmbeddingPropCovered"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedEmbeddingPropCovered">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedEmbeddingPropCovered</span><span class="p">(</span><span class="n">propCovered</span><span class="p">,</span> <span class="n">percent</span><span class="p">,</span>
                                                   <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Neuron&quot;</span><span class="p">,</span>
                                                   <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Coverage&quot;</span><span class="p">,</span>
                                                   <span class="n">tColor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">pColor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                                   <span class="n">mColor</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">):</span>
    <span class="n">nIndices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">propCovered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">traceT</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">nIndices</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">propCovered</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">tColor</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">tColor</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">traceP</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">nIndices</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">propCovered</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">pColor</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">pColor</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Python&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceT</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceP</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotTruePythonAndMatlabEmbeddingPropCovered"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTruePythonAndMatlabEmbeddingPropCovered">[docs]</a><span class="k">def</span> <span class="nf">getPlotTruePythonAndMatlabEmbeddingPropCovered</span><span class="p">(</span><span class="n">propCovered</span><span class="p">,</span> <span class="n">percent</span><span class="p">,</span>
                                                   <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Neuron&quot;</span><span class="p">,</span>
                                                   <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Coverage&quot;</span><span class="p">,</span>
                                                   <span class="n">tColor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">pColor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                                   <span class="n">mColor</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">):</span>
    <span class="n">nIndices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">propCovered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">traceT</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">nIndices</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">propCovered</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">tColor</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">tColor</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">traceP</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">nIndices</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">propCovered</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">pColor</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">pColor</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Python&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">traceM</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">nIndices</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">propCovered</span><span class="p">[</span><span class="mi">2</span><span class="p">,:],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">mColor</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">mColor</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Matlab&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceT</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceP</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceM</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotTruePythonAndMatlabEmbedding"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTruePythonAndMatlabEmbedding">[docs]</a><span class="k">def</span> <span class="nf">getPlotTruePythonAndMatlabEmbedding</span><span class="p">(</span><span class="n">tTimes</span><span class="p">,</span> <span class="n">tSamples</span><span class="p">,</span> <span class="n">tMeans</span><span class="p">,</span> <span class="n">tSTDs</span><span class="p">,</span>
                                        <span class="n">pTimes</span><span class="p">,</span> <span class="n">pMeans</span><span class="p">,</span> <span class="n">pSTDs</span><span class="p">,</span>
                                        <span class="n">mTimes</span><span class="p">,</span> <span class="n">mMeans</span><span class="p">,</span> <span class="n">mSTDs</span><span class="p">,</span>
                                        <span class="n">CBalpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
                                        <span class="n">tCBFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,255,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                                        <span class="n">tSamplesLineColor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                        <span class="n">tMeanLineColor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                        <span class="n">pCBFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                                        <span class="n">pMeanLineColor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                        <span class="n">mCBFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(0,255,0,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                                        <span class="n">mMeanLineColor</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                                        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span>
                                        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Embedding&quot;</span><span class="p">,</span>
                                        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="c1"># tSamples[r], tMeans[r], tSTDs[r],</span>
    <span class="c1"># eMean[r], eSTDs[r] \in nNeurons x nSamples</span>
    <span class="c1"># pio.renderers.default = &quot;browser&quot;</span>
    <span class="c1">#</span>
    <span class="n">pCI</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">pSTDs</span>
    <span class="n">xP</span> <span class="o">=</span> <span class="n">pTimes</span>
    <span class="n">xP_rev</span> <span class="o">=</span> <span class="n">xP</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">yP</span> <span class="o">=</span> <span class="n">pMeans</span>
    <span class="n">yP_upper</span> <span class="o">=</span> <span class="n">yP</span> <span class="o">+</span> <span class="n">pCI</span>
    <span class="n">yP_lower</span> <span class="o">=</span> <span class="n">yP</span> <span class="o">-</span> <span class="n">pCI</span>
    <span class="n">yP_lower</span> <span class="o">=</span> <span class="n">yP_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">xP</span> <span class="o">=</span> <span class="n">xP</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yP</span> <span class="o">=</span> <span class="n">yP</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yP_upper</span> <span class="o">=</span> <span class="n">yP_upper</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yP_lower</span> <span class="o">=</span> <span class="n">yP_lower</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">mCI</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">mSTDs</span>
    <span class="n">xM</span> <span class="o">=</span> <span class="n">mTimes</span>
    <span class="n">xM_rev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">xM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">yM</span> <span class="o">=</span> <span class="n">mMeans</span>
    <span class="n">yM_upper</span> <span class="o">=</span> <span class="n">yM</span> <span class="o">+</span> <span class="n">mCI</span>
    <span class="n">yM_lower</span> <span class="o">=</span> <span class="n">yM</span> <span class="o">-</span> <span class="n">mCI</span>
    <span class="n">yM_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">yM_lower</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">tCI</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">tSTDs</span>
    <span class="n">xT</span> <span class="o">=</span> <span class="n">tTimes</span>
    <span class="n">xT_rev</span> <span class="o">=</span> <span class="n">xT</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">yTMeans</span> <span class="o">=</span> <span class="n">tMeans</span>
    <span class="n">yTSamples</span> <span class="o">=</span> <span class="n">tSamples</span>
    <span class="n">yTMeans_upper</span> <span class="o">=</span> <span class="n">yTMeans</span> <span class="o">+</span> <span class="n">tCI</span>
    <span class="n">yTMeans_lower</span> <span class="o">=</span> <span class="n">yTMeans</span> <span class="o">-</span> <span class="n">tCI</span>
    <span class="n">yTMeans_lower</span> <span class="o">=</span> <span class="n">yTMeans_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">xT</span> <span class="o">=</span> <span class="n">xT</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yTMeans</span> <span class="o">=</span> <span class="n">yTMeans</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yTSamples</span> <span class="o">=</span> <span class="n">yTSamples</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yTMeans_upper</span> <span class="o">=</span> <span class="n">yTMeans_upper</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yTMeans_lower</span> <span class="o">=</span> <span class="n">yTMeans_lower</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">tracePCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xP</span><span class="p">,</span> <span class="n">xP_rev</span><span class="p">)),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yP_upper</span><span class="p">,</span> <span class="n">yP_lower</span><span class="p">)),</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="n">pCBFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CBalpha</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tracePMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xP</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yP</span><span class="p">,</span>
        <span class="c1"># line=dict(color=&quot;rgb(0,100,80)&quot;),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">pMeanLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Python Mean&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceMCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xM</span><span class="p">,</span> <span class="n">xM_rev</span><span class="p">)),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yM_upper</span><span class="p">,</span> <span class="n">yM_lower</span><span class="p">)),</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="n">mCBFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CBalpha</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceMMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xM</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yM</span><span class="p">,</span>
        <span class="c1"># line=dict(color=&quot;rgb(0,100,80)&quot;),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">mMeanLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Matlab Mean&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceTCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xT</span><span class="p">,</span> <span class="n">xT_rev</span><span class="p">)),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yTMeans_upper</span><span class="p">,</span> <span class="n">yTMeans_lower</span><span class="p">)),</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="n">tCBFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CBalpha</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceTMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xT</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yTMeans</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">tMeanLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True Mean&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceTSamples</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xT</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yTSamples</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">tSamplesLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True Sample&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">tracePCB</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">tracePMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceMCB</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceMMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTCB</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTSamples</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<span class="c1"># inducing points</span>
<div class="viewcode-block" id="getPlotTrueAndEstimatedIndPointsLocs"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedIndPointsLocs">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedIndPointsLocs</span><span class="p">(</span><span class="n">trueIndPointsLocs</span><span class="p">,</span>
                                         <span class="n">estimatedIndPointsLocs</span><span class="p">,</span>
                                         <span class="n">linetypeTrue</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
                                         <span class="n">linetypeEstimated</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
                                         <span class="n">labelTrue</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
                                         <span class="n">labelEstimated</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
                                         <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;asterisk&quot;</span><span class="p">,</span>
                                         <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Inducing Point Index&quot;</span><span class="p">,</span>
                                         <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Inducing Point Location&quot;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getTracesOneSetTrueAndEstimatedIndPointsLocs</span><span class="p">(</span>
        <span class="n">trueIndPointsLocs</span><span class="p">,</span>
        <span class="n">estimatedIndPointsLocs</span><span class="p">,</span>
        <span class="n">labelTrue</span><span class="p">,</span> <span class="n">labelEstimated</span><span class="p">,</span>
        <span class="n">useLegend</span><span class="p">):</span>
        <span class="n">traceTrue</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">trueIndPointsLocs</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">labelTrue</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dash</span><span class="o">=</span><span class="n">linetypeTrue</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
        <span class="n">traceEstimated</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">estimatedIndPointsLocs</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">labelEstimated</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dash</span><span class="o">=</span><span class="n">linetypeEstimated</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">traceTrue</span><span class="p">,</span> <span class="n">traceEstimated</span>

    <span class="n">nLatents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trueIndPointsLocs</span><span class="p">)</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="n">trueIndPointsLocs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">subplots</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">nLatents</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">==</span><span class="n">nLatents</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">useLegend</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">useLegend</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">traceTrue</span><span class="p">,</span> <span class="n">traceEstimated</span> <span class="o">=</span> <span class="n">getTracesOneSetTrueAndEstimatedIndPointsLocs</span><span class="p">(</span><span class="n">trueIndPointsLocs</span><span class="o">=</span><span class="n">trueIndPointsLocs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">r</span><span class="p">,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">estimatedIndPointsLocs</span><span class="o">=</span><span class="n">estimatedIndPointsLocs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">r</span><span class="p">,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">labelTrue</span><span class="o">=</span><span class="n">labelTrue</span><span class="p">,</span> <span class="n">labelEstimated</span><span class="o">=</span><span class="n">labelEstimated</span><span class="p">,</span> <span class="n">useLegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTrue</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceEstimated</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Trial </span><span class="si">{:d}</span><span class="s2">, Latent </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">n_trials</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">nLatents</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotTrueAndEstimatedIndPointsLocsOneTrialOneLatent"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedIndPointsLocsOneTrialOneLatent">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedIndPointsLocsOneTrialOneLatent</span><span class="p">(</span>
    <span class="n">trueIndPointsLocs</span><span class="p">,</span>
    <span class="n">estimatedIndPointsLocs</span><span class="p">,</span>
    <span class="n">title</span><span class="p">,</span>
    <span class="n">linetypeTrue</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
    <span class="n">linetypeEstimated</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
    <span class="n">labelTrue</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
    <span class="n">labelEstimated</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;asterisk&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Inducing Point Index&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Inducing Point Location&quot;</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">getTracesOneSetTrueAndEstimatedIndPointsLocs</span><span class="p">(</span>
        <span class="n">trueIndPointsLocs</span><span class="p">,</span>
        <span class="n">estimatedIndPointsLocs</span><span class="p">,</span>
        <span class="n">labelTrue</span><span class="p">,</span> <span class="n">labelEstimated</span><span class="p">,</span>
        <span class="n">useLegend</span><span class="p">):</span>
        <span class="n">traceTrue</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">trueIndPointsLocs</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">labelTrue</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dash</span><span class="o">=</span><span class="n">linetypeTrue</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
        <span class="n">traceEstimated</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">estimatedIndPointsLocs</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">labelEstimated</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dash</span><span class="o">=</span><span class="n">linetypeEstimated</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">traceTrue</span><span class="p">,</span> <span class="n">traceEstimated</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">traceTrue</span><span class="p">,</span> <span class="n">traceEstimated</span> <span class="o">=</span> <span class="n">getTracesOneSetTrueAndEstimatedIndPointsLocs</span><span class="p">(</span><span class="n">trueIndPointsLocs</span><span class="o">=</span><span class="n">trueIndPointsLocs</span><span class="p">,</span> <span class="n">estimatedIndPointsLocs</span><span class="o">=</span><span class="n">estimatedIndPointsLocs</span><span class="p">,</span> <span class="n">labelTrue</span><span class="o">=</span><span class="n">labelTrue</span><span class="p">,</span> <span class="n">labelEstimated</span><span class="o">=</span><span class="n">labelEstimated</span><span class="p">,</span> <span class="n">useLegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTrue</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceEstimated</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<span class="c1"># variational params</span>
<div class="viewcode-block" id="getPlotTrueAndEstimatedIndPointsMeans"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedIndPointsMeans">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedIndPointsMeans</span><span class="p">(</span><span class="n">trueIndPointsMeans</span><span class="p">,</span>
                                          <span class="n">estimatedIndPointsMeans</span><span class="p">,</span>
                                          <span class="n">linetypeTrue</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
                                          <span class="n">linetypeEstimated</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
                                          <span class="n">labelTrue</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
                                          <span class="n">labelEstimated</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
                                          <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Inducing Point Index&quot;</span><span class="p">,</span>
                                          <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Inducing Point Mean&quot;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getTracesOneSetTrueAndEstimatedIndPointsMeans</span><span class="p">(</span>
        <span class="n">trueIndPointsMean</span><span class="p">,</span>
        <span class="n">estimatedIndPointsMean</span><span class="p">,</span>
        <span class="n">labelTrue</span><span class="p">,</span> <span class="n">labelEstimated</span><span class="p">,</span>
        <span class="n">useLegend</span><span class="p">):</span>
        <span class="n">traceTrue</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">trueIndPointsMean</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">labelTrue</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dash</span><span class="o">=</span><span class="n">linetypeTrue</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
        <span class="n">traceEstimated</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">estimatedIndPointsMean</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">labelEstimated</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dash</span><span class="o">=</span><span class="n">linetypeEstimated</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">traceTrue</span><span class="p">,</span> <span class="n">traceEstimated</span>

    <span class="c1"># trueIndPointsMeans[r][k] \in nInd[k]</span>
    <span class="c1"># qMu[k] \in n_trials x nInd[k] x 1</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trueIndPointsMeans</span><span class="p">)</span>
    <span class="n">nLatents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trueIndPointsMeans</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">subplots</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">nLatents</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">):</span>
            <span class="n">trueIndPointsMean</span> <span class="o">=</span> <span class="n">trueIndPointsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">k</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">estimatedIndPointsMean</span> <span class="o">=</span> <span class="n">estimatedIndPointsMeans</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">r</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">==</span><span class="n">nLatents</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">useLegend</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">useLegend</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">traceTrue</span><span class="p">,</span> <span class="n">traceEstimated</span> <span class="o">=</span> <span class="n">getTracesOneSetTrueAndEstimatedIndPointsMeans</span><span class="p">(</span><span class="n">trueIndPointsMean</span><span class="o">=</span><span class="n">trueIndPointsMean</span><span class="p">,</span> <span class="n">estimatedIndPointsMean</span><span class="o">=</span><span class="n">estimatedIndPointsMean</span><span class="p">,</span> <span class="n">labelTrue</span><span class="o">=</span><span class="n">labelTrue</span><span class="p">,</span> <span class="n">labelEstimated</span><span class="o">=</span><span class="n">labelEstimated</span><span class="p">,</span> <span class="n">useLegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTrue</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceEstimated</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Trial </span><span class="si">{:d}</span><span class="s2">, Latent </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">n_trials</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">nLatents</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotTrueAndEstimatedIndPointsMeansOneTrialOneLatent"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedIndPointsMeansOneTrialOneLatent">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedIndPointsMeansOneTrialOneLatent</span><span class="p">(</span>
    <span class="n">trueIndPointsMeans</span><span class="p">,</span>
    <span class="n">estimatedIndPointsMeans</span><span class="p">,</span>
    <span class="n">trueIndPointsSTDs</span><span class="p">,</span>
    <span class="n">estimatedIndPointsSTDs</span><span class="p">,</span>
    <span class="n">title</span><span class="p">,</span>
    <span class="n">cbAlpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">trueCBFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,255,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="n">trueMeanLineColor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="n">estimatedCBFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="n">estimatedMeanLineColor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Inducing Point Index&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Inducing Point Mean&quot;</span><span class="p">):</span>

    <span class="n">tIndPointsIndices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trueIndPointsMeans</span><span class="p">))</span>
    <span class="n">eIndPointsIndices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">estimatedIndPointsMeans</span><span class="p">))</span>

    <span class="n">eCI</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">estimatedIndPointsSTDs</span>
    <span class="n">xE</span> <span class="o">=</span> <span class="n">eIndPointsIndices</span>
    <span class="n">xE_rev</span> <span class="o">=</span> <span class="n">xE</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">yE</span> <span class="o">=</span> <span class="n">estimatedIndPointsMeans</span>
    <span class="n">yE_upper</span> <span class="o">=</span> <span class="n">yE</span> <span class="o">+</span> <span class="n">eCI</span>
    <span class="n">yE_lower</span> <span class="o">=</span> <span class="n">yE</span> <span class="o">-</span> <span class="n">eCI</span>
    <span class="n">yE_lower</span> <span class="o">=</span> <span class="n">yE_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">xE</span> <span class="o">=</span> <span class="n">xE</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yE</span> <span class="o">=</span> <span class="n">yE</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yE_upper</span> <span class="o">=</span> <span class="n">yE_upper</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yE_lower</span> <span class="o">=</span> <span class="n">yE_lower</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">tCI</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">trueIndPointsSTDs</span>
    <span class="n">xT</span> <span class="o">=</span> <span class="n">tIndPointsIndices</span>
    <span class="n">xT_rev</span> <span class="o">=</span> <span class="n">xT</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">yT</span> <span class="o">=</span> <span class="n">trueIndPointsMeans</span>
    <span class="n">yT_upper</span> <span class="o">=</span> <span class="n">yT</span> <span class="o">+</span> <span class="n">tCI</span>
    <span class="n">yT_lower</span> <span class="o">=</span> <span class="n">yT</span> <span class="o">-</span> <span class="n">tCI</span>
    <span class="n">yT_lower</span> <span class="o">=</span> <span class="n">yT_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">xT</span> <span class="o">=</span> <span class="n">xT</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yT</span> <span class="o">=</span> <span class="n">yT</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yT_upper</span> <span class="o">=</span> <span class="n">yT_upper</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yT_lower</span> <span class="o">=</span> <span class="n">yT_lower</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">traceECB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xE</span><span class="p">,</span> <span class="n">xE_rev</span><span class="p">)),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yE_upper</span><span class="p">,</span> <span class="n">yE_lower</span><span class="p">)),</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="n">estimatedCBFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cbAlpha</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceEMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xE</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yE</span><span class="p">,</span>
        <span class="c1"># line=dict(color=&quot;rgb(0,100,80)&quot;),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">estimatedMeanLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Estimated Mean&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceTCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xT</span><span class="p">,</span> <span class="n">xT_rev</span><span class="p">)),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yT_upper</span><span class="p">,</span> <span class="n">yT_lower</span><span class="p">)),</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="n">trueCBFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cbAlpha</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceTMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xT</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yT</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">trueMeanLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True Mean&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceECB</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceEMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTCB</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<span class="c1">#     def getTracesOneSetTrueAndEstimatedIndPointsMeans(</span>
<span class="c1">#         trueIndPointsMeans,</span>
<span class="c1">#         estimatedIndPointsMeans,</span>
<span class="c1">#         labelTrue, labelEstimated,</span>
<span class="c1">#         useLegend):</span>
<span class="c1">#         traceTrue = go.Scatter(</span>
<span class="c1">#             y=trueIndPointsMeans,</span>
<span class="c1">#             mode=&quot;lines+markers&quot;,</span>
<span class="c1">#             name=labelTrue,</span>
<span class="c1">#             line=dict(dash=linetypeTrue),</span>
<span class="c1">#             showlegend=useLegend)</span>
<span class="c1">#         traceEstimated = go.Scatter(</span>
<span class="c1">#             y=estimatedIndPointsMeans,</span>
<span class="c1">#             mode=&quot;lines+markers&quot;,</span>
<span class="c1">#             name=labelEstimated,</span>
<span class="c1">#             line=dict(dash=linetypeEstimated),</span>
<span class="c1">#             showlegend=useLegend)</span>
<span class="c1">#         return traceTrue, traceEstimated</span>
<span class="c1"># </span>
<span class="c1">#     # qMu[k] \in n_trials x nInd[k] x 1</span>
<span class="c1">#     fig = go.Figure()</span>
<span class="c1">#     traceTrue, traceEstimated = getTracesOneSetTrueAndEstimatedIndPointsMeans(trueIndPointsMeans=trueIndPointsMeans, estimatedIndPointsMeans=estimatedIndPointsMeans, labelTrue=labelTrue, labelEstimated=labelEstimated, useLegend=True)</span>
<span class="c1">#     fig.add_trace(traceTrue)</span>
<span class="c1">#     fig.add_trace(traceEstimated)</span>
<span class="c1">#     fig.update_layout(title=title)</span>
<span class="c1">#     fig.update_yaxes(title_text=ylabel)</span>
<span class="c1">#     fig.update_xaxes(title_text=xlabel)</span>
<span class="c1">#     return fig</span>

<div class="viewcode-block" id="getPlotTrueAndEstimatedIndPointsCovs"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedIndPointsCovs">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedIndPointsCovs</span><span class="p">(</span><span class="n">trueIndPointsCovs</span><span class="p">,</span>
                                         <span class="n">estimatedIndPointsCovs</span><span class="p">,</span>
                                         <span class="n">linetypeTrue</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
                                         <span class="n">linetypeEstimated</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
                                         <span class="n">labelTruePattern</span><span class="o">=</span><span class="s2">&quot;True[:,</span><span class="si">{:d}</span><span class="s2">]&quot;</span><span class="p">,</span>
                                         <span class="n">labelEstimatedPattern</span><span class="o">=</span><span class="s2">&quot;Estimated[:,</span><span class="si">{:d}</span><span class="s2">]&quot;</span><span class="p">,</span>
                                         <span class="n">colorsList</span><span class="o">=</span><span class="n">plotly</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">qualitative</span><span class="o">.</span><span class="n">Plotly</span><span class="p">,</span>
                                         <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Inducing Point Index&quot;</span><span class="p">,</span>
                                         <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Inducing Points Covariance&quot;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getTracesOneSetTrueAndEstimatedIndPointsCovs</span><span class="p">(</span>
        <span class="n">trueIndPointsCov</span><span class="p">,</span>
        <span class="n">estimatedIndPointsCov</span><span class="p">,</span>
        <span class="n">labelTruePattern</span><span class="p">,</span> <span class="n">labelEstimatedPattern</span><span class="p">,</span>
        <span class="n">useLegend</span><span class="p">):</span>
        <span class="n">nCols</span> <span class="o">=</span> <span class="n">trueIndPointsCov</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">tracesTrue</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nCols</span><span class="p">)]</span>
        <span class="n">tracesEstimated</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nCols</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nCols</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">colorsList</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">colorsList</span><span class="p">)]</span>
            <span class="n">tracesTrue</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">y</span><span class="o">=</span><span class="n">trueIndPointsCov</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">labelTruePattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dash</span><span class="o">=</span><span class="n">linetypeTrue</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
            <span class="n">tracesEstimated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">y</span><span class="o">=</span><span class="n">estimatedIndPointsCov</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">labelEstimatedPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dash</span><span class="o">=</span><span class="n">linetypeEstimated</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tracesTrue</span><span class="p">,</span> <span class="n">tracesEstimated</span>

    <span class="c1"># trueIndPointsCovs[r][k] \in nInd[k]</span>
    <span class="c1"># qMu[k] \in n_trials x nInd[k] x 1</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trueIndPointsCovs</span><span class="p">)</span>
    <span class="n">nLatents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trueIndPointsCovs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">subplots</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">nLatents</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">):</span>
            <span class="n">trueIndPointsCov</span> <span class="o">=</span> <span class="n">trueIndPointsCovs</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
            <span class="n">estimatedIndPointsCov</span> <span class="o">=</span> <span class="n">estimatedIndPointsCovs</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">==</span><span class="n">nLatents</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">useLegend</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">useLegend</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">tracesTrue</span><span class="p">,</span> <span class="n">tracesEstimated</span> <span class="o">=</span> <span class="n">getTracesOneSetTrueAndEstimatedIndPointsCovs</span><span class="p">(</span><span class="n">trueIndPointsCov</span><span class="o">=</span><span class="n">trueIndPointsCov</span><span class="p">,</span> <span class="n">estimatedIndPointsCov</span><span class="o">=</span><span class="n">estimatedIndPointsCov</span><span class="p">,</span> <span class="n">labelTruePattern</span><span class="o">=</span><span class="n">labelTruePattern</span><span class="p">,</span> <span class="n">labelEstimatedPattern</span><span class="o">=</span><span class="n">labelEstimatedPattern</span><span class="p">,</span> <span class="n">useLegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tracesTrue</span><span class="p">)):</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">tracesTrue</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">tracesEstimated</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Trial </span><span class="si">{:d}</span><span class="s2">, Latent </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">n_trials</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">nLatents</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotTrueAndEstimatedIndPointsCovsOneTrialOneLatent"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedIndPointsCovsOneTrialOneLatent">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedIndPointsCovsOneTrialOneLatent</span><span class="p">(</span>
    <span class="n">trueIndPointsCov</span><span class="p">,</span>
    <span class="n">estimatedIndPointsCov</span><span class="p">,</span>
    <span class="n">title</span><span class="p">,</span>
    <span class="n">linetypeTrue</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
    <span class="n">linetypeEstimated</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
    <span class="n">labelTruePattern</span><span class="o">=</span><span class="s2">&quot;True[:,</span><span class="si">{:d}</span><span class="s2">]&quot;</span><span class="p">,</span>
    <span class="n">labelEstimatedPattern</span><span class="o">=</span><span class="s2">&quot;Estimated[:,</span><span class="si">{:d}</span><span class="s2">]&quot;</span><span class="p">,</span>
    <span class="n">colorsList</span><span class="o">=</span><span class="n">plotly</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">qualitative</span><span class="o">.</span><span class="n">Plotly</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Inducing Point Index&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Inducing Points Covariance&quot;</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">getTracesOneSetTrueAndEstimatedIndPointsCovs</span><span class="p">(</span>
        <span class="n">trueIndPointsCov</span><span class="p">,</span>
        <span class="n">estimatedIndPointsCov</span><span class="p">,</span>
        <span class="n">labelTruePattern</span><span class="p">,</span> <span class="n">labelEstimatedPattern</span><span class="p">,</span>
        <span class="n">useLegend</span><span class="p">):</span>
        <span class="n">nCols</span> <span class="o">=</span> <span class="n">trueIndPointsCov</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">tracesTrue</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nCols</span><span class="p">)]</span>
        <span class="n">tracesEstimated</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nCols</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nCols</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">colorsList</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">colorsList</span><span class="p">)]</span>
            <span class="n">tracesTrue</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">y</span><span class="o">=</span><span class="n">trueIndPointsCov</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">labelTruePattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dash</span><span class="o">=</span><span class="n">linetypeTrue</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
            <span class="n">tracesEstimated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">y</span><span class="o">=</span><span class="n">estimatedIndPointsCov</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">labelEstimatedPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dash</span><span class="o">=</span><span class="n">linetypeEstimated</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tracesTrue</span><span class="p">,</span> <span class="n">tracesEstimated</span>

    <span class="c1"># trueIndPointsCovs[r][k] \in nInd[k]</span>
    <span class="c1"># qMu[k] \in n_trials x nInd[k] x 1</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">tracesTrue</span><span class="p">,</span> <span class="n">tracesEstimated</span> <span class="o">=</span> <span class="n">getTracesOneSetTrueAndEstimatedIndPointsCovs</span><span class="p">(</span><span class="n">trueIndPointsCov</span><span class="o">=</span><span class="n">trueIndPointsCov</span><span class="p">,</span> <span class="n">estimatedIndPointsCov</span><span class="o">=</span><span class="n">estimatedIndPointsCov</span><span class="p">,</span> <span class="n">labelTruePattern</span><span class="o">=</span><span class="n">labelTruePattern</span><span class="p">,</span> <span class="n">labelEstimatedPattern</span><span class="o">=</span><span class="n">labelEstimatedPattern</span><span class="p">,</span> <span class="n">useLegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tracesTrue</span><span class="p">)):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">tracesTrue</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">tracesEstimated</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<span class="c1"># latents</span>
<div class="viewcode-block" id="getPlotTruePythonAndMatlabLatents"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTruePythonAndMatlabLatents">[docs]</a><span class="k">def</span> <span class="nf">getPlotTruePythonAndMatlabLatents</span><span class="p">(</span><span class="n">tTimes</span><span class="p">,</span> <span class="n">tLatents</span><span class="p">,</span>
                                      <span class="n">pTimes</span><span class="p">,</span> <span class="n">pMuK</span><span class="p">,</span> <span class="n">pVarK</span><span class="p">,</span>
                                      <span class="n">mTimes</span><span class="p">,</span> <span class="n">mMuK</span><span class="p">,</span> <span class="n">mVarK</span><span class="p">,</span>
                                      <span class="n">trialToPlot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                      <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span>
                                      <span class="n">ylabelPattern</span><span class="o">=</span><span class="s2">&quot;Latent </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="c1"># pio.renderers.default = &quot;browser&quot;</span>
    <span class="n">nLatents</span> <span class="o">=</span> <span class="n">mMuK</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">subplots</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">nLatents</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># titles = [&quot;Trial {:d}&quot;.format(trialToPlot)] + [&quot;&quot; for i in range(nLatents)]</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Trial </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trialToPlot</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">):</span>
        <span class="n">trueToPlot</span> <span class="o">=</span> <span class="n">tLatents</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">,:,</span><span class="n">k</span><span class="p">]</span>

        <span class="n">pMeanToPlot</span> <span class="o">=</span> <span class="n">pMuK</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">,:,</span><span class="n">k</span><span class="p">]</span>
        <span class="n">positiveMSE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">trueToPlot</span><span class="o">-</span><span class="n">pMeanToPlot</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">negativeMSE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">trueToPlot</span><span class="o">+</span><span class="n">pMeanToPlot</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">negativeMSE</span><span class="o">&lt;</span><span class="n">positiveMSE</span><span class="p">:</span>
            <span class="n">pMeanToPlot</span> <span class="o">=</span> <span class="o">-</span><span class="n">pMeanToPlot</span>
        <span class="n">pCIToPlot</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="p">(</span><span class="n">pVarK</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">,:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sqrt</span><span class="p">())</span>

        <span class="n">mMeanToPlot</span> <span class="o">=</span> <span class="n">mMuK</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">,:,</span><span class="n">k</span><span class="p">]</span>
        <span class="n">positiveMSE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">trueToPlot</span><span class="o">-</span><span class="n">mMeanToPlot</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">negativeMSE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">trueToPlot</span><span class="o">+</span><span class="n">mMeanToPlot</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">negativeMSE</span><span class="o">&lt;</span><span class="n">positiveMSE</span><span class="p">:</span>
            <span class="n">mMeanToPlot</span> <span class="o">=</span> <span class="o">-</span><span class="n">mMeanToPlot</span>
        <span class="n">mCIToPlot</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="p">(</span><span class="n">mVarK</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">,:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sqrt</span><span class="p">())</span>

        <span class="n">tLatentToPlot</span> <span class="o">=</span> <span class="n">tLatents</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">,:,</span><span class="n">k</span><span class="p">]</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="n">pTimes</span>
        <span class="n">x1_rev</span> <span class="o">=</span> <span class="n">x1</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">pMeanToPlot</span>
        <span class="n">y1_upper</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">pCIToPlot</span>
        <span class="n">y1_lower</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">pCIToPlot</span>
        <span class="c1"># y1_lower = y1_lower[::-1] # negative stride not supported in pytorch</span>
        <span class="n">y1_lower</span> <span class="o">=</span> <span class="n">y1_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">x2</span> <span class="o">=</span> <span class="n">mTimes</span>
        <span class="n">x2_rev</span> <span class="o">=</span> <span class="n">x2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">mMeanToPlot</span>
        <span class="n">y2_upper</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">mCIToPlot</span>
        <span class="n">y2_lower</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">mCIToPlot</span>
        <span class="c1"># y2_lower = y2_lower[::-1] # negative stride not supported in pytorch</span>
        <span class="n">y2_lower</span> <span class="o">=</span> <span class="n">y2_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">x3</span> <span class="o">=</span> <span class="n">tTimes</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="n">tLatentToPlot</span>

        <span class="n">trace1</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">x1_rev</span><span class="p">)),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">y1_upper</span><span class="p">,</span> <span class="n">y1_lower</span><span class="p">)),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,0.2)&quot;</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Python&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">trace2</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x2</span><span class="p">,</span> <span class="n">x2_rev</span><span class="p">)),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">y2_upper</span><span class="p">,</span> <span class="n">y2_lower</span><span class="p">)),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,255,0.2)&quot;</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Matlab&quot;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">trace3</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span>
            <span class="c1"># line=dict(color=&quot;rgb(0,100,80)&quot;),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Python&quot;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">trace4</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span>
            <span class="c1"># line=dict(color=&quot;rgb(0,176,246)&quot;),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Matlab&quot;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">trace5</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y3</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace1</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace2</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace3</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace4</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace5</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabelPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># pdb.set_trace()</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotTrueAndEstimatedLatents"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedLatents">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedLatents</span><span class="p">(</span><span class="n">tTimes</span><span class="p">,</span> <span class="n">tLatentsSamples</span><span class="p">,</span> <span class="n">tLatentsMeans</span><span class="p">,</span> <span class="n">tLatentsSTDs</span><span class="p">,</span> <span class="n">tIndPointsLocs</span><span class="p">,</span>
                                   <span class="n">eTimes</span><span class="p">,</span> <span class="n">eLatentsMeans</span><span class="p">,</span> <span class="n">eLatentsSTDs</span><span class="p">,</span> <span class="n">eIndPointsLocs</span><span class="p">,</span>
                                   <span class="n">trialToPlot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                   <span class="n">CBalpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
                                   <span class="n">tCBFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,255,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                                   <span class="n">tSamplesLineColor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                   <span class="n">tMeanLineColor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                   <span class="n">eCBFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                                   <span class="n">eMeanLineColor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                   <span class="n">tIndPointsLocsColor</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,255,0.5)&quot;</span><span class="p">,</span>
                                   <span class="n">eIndPointsLocsColor</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,0.5)&quot;</span><span class="p">,</span>
                                   <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span>
                                   <span class="n">ylabelPattern</span><span class="o">=</span><span class="s2">&quot;Latent </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="p">,</span>
                                   <span class="n">titlePattern</span><span class="o">=</span><span class="s2">&quot;Trial </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="n">eLatentsMeans</span> <span class="o">=</span> <span class="n">eLatentsMeans</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
    <span class="n">eLatentsSTDs</span> <span class="o">=</span> <span class="n">eLatentsSTDs</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
    <span class="n">eIndPointsLocs</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">eIndPointsLocs</span><span class="p">]</span>

    <span class="c1"># pio.renderers.default = &quot;browser&quot;</span>
    <span class="n">nLatents</span> <span class="o">=</span> <span class="n">eLatentsMeans</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">subplots</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">nLatents</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">titlePattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trialToPlot</span><span class="p">)</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tLatentsSTDs</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># latentsMaxs = [1.96*torch.max(tLatentsSTDs[r]).item() for r in range(n_trials)]</span>
    <span class="c1"># latentsMaxs.append((torch.max(eLatentsMeans)+1.96*torch.max(eLatentsSTDs)).item())</span>
    <span class="c1"># ymax = max(latentsMaxs)</span>
    <span class="c1">#</span>
    <span class="c1"># latentsMins = [1.96*torch.max(tLatentsSTDs[r]).item() for r in range(n_trials)]</span>
    <span class="c1"># latentsMins.append((torch.min(eLatentsMeans)-1.96*torch.max(eLatentsSTDs)).item())</span>
    <span class="c1"># ymin = min(latentsMins)</span>
    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">):</span>
        <span class="n">tSamplesToPlot</span> <span class="o">=</span> <span class="n">tLatentsSamples</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">][</span><span class="n">k</span><span class="p">,:]</span>
        <span class="n">tMeanToPlot</span> <span class="o">=</span> <span class="n">tLatentsMeans</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">][</span><span class="n">k</span><span class="p">,:]</span>
        <span class="n">tSTDToPlot</span> <span class="o">=</span> <span class="n">tLatentsSTDs</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">][</span><span class="n">k</span><span class="p">,:]</span>
        <span class="n">tCIToPlot</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">tSTDToPlot</span>

        <span class="n">eMeanToPlot</span> <span class="o">=</span> <span class="n">eLatentsMeans</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">,:,</span><span class="n">k</span><span class="p">]</span>
        <span class="n">eSTDToPlot</span> <span class="o">=</span> <span class="n">eLatentsSTDs</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">,:,</span><span class="n">k</span><span class="p">]</span>
        <span class="n">positiveMSE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">tMeanToPlot</span><span class="o">-</span><span class="n">eMeanToPlot</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">negativeMSE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">tMeanToPlot</span><span class="o">+</span><span class="n">eMeanToPlot</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">negativeMSE</span><span class="o">&lt;</span><span class="n">positiveMSE</span><span class="p">:</span>
            <span class="n">eMeanToPlot</span> <span class="o">=</span> <span class="o">-</span><span class="n">eMeanToPlot</span>
        <span class="n">eCIToPlot</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">eSTDToPlot</span>

        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tMeanToPlot</span><span class="o">+</span><span class="n">tCIToPlot</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eMeanToPlot</span><span class="o">+</span><span class="n">eCIToPlot</span><span class="p">))</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tMeanToPlot</span><span class="o">-</span><span class="n">tCIToPlot</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eMeanToPlot</span><span class="o">-</span><span class="n">eCIToPlot</span><span class="p">))</span>

        <span class="n">xE</span> <span class="o">=</span> <span class="n">eTimes</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">xE_rev</span> <span class="o">=</span> <span class="n">xE</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">yE</span> <span class="o">=</span> <span class="n">eMeanToPlot</span>
        <span class="n">yE_upper</span> <span class="o">=</span> <span class="n">yE</span> <span class="o">+</span> <span class="n">eCIToPlot</span>
        <span class="n">yE_lower</span> <span class="o">=</span> <span class="n">yE</span> <span class="o">-</span> <span class="n">eCIToPlot</span>
        <span class="n">yE_lower</span> <span class="o">=</span> <span class="n">yE_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">xE</span> <span class="o">=</span> <span class="n">xE</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">yE</span> <span class="o">=</span> <span class="n">yE</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">yE_upper</span> <span class="o">=</span> <span class="n">yE_upper</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">yE_lower</span> <span class="o">=</span> <span class="n">yE_lower</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="n">xT</span> <span class="o">=</span> <span class="n">tTimes</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">xT_rev</span> <span class="o">=</span> <span class="n">xT</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">yT</span> <span class="o">=</span> <span class="n">tMeanToPlot</span>
        <span class="n">yTSamples</span> <span class="o">=</span> <span class="n">tSamplesToPlot</span>
        <span class="n">yT_upper</span> <span class="o">=</span> <span class="n">yT</span> <span class="o">+</span> <span class="n">tCIToPlot</span>
        <span class="n">yT_lower</span> <span class="o">=</span> <span class="n">yT</span> <span class="o">-</span> <span class="n">tCIToPlot</span>
        <span class="n">yT_lower</span> <span class="o">=</span> <span class="n">yT_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">xT</span> <span class="o">=</span> <span class="n">xT</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">yT</span> <span class="o">=</span> <span class="n">yT</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">yTSamples</span> <span class="o">=</span> <span class="n">yTSamples</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">yT_upper</span> <span class="o">=</span> <span class="n">yT_upper</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">yT_lower</span> <span class="o">=</span> <span class="n">yT_lower</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="n">traceECB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xE</span><span class="p">,</span> <span class="n">xE_rev</span><span class="p">)),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yE_upper</span><span class="p">,</span> <span class="n">yE_lower</span><span class="p">)),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="n">eCBFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CBalpha</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">traceEMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">xE</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">yE</span><span class="p">,</span>
            <span class="c1"># line=dict(color=&quot;rgb(0,100,80)&quot;),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">eMeanLineColor</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">traceTCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xT</span><span class="p">,</span> <span class="n">xT_rev</span><span class="p">)),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yT_upper</span><span class="p">,</span> <span class="n">yT_lower</span><span class="p">)),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="n">tCBFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CBalpha</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">traceTMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">xT</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">yT</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">tMeanLineColor</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">traceTSamples</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">xT</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">yTSamples</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">tSamplesLineColor</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceECB</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceEMean</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTCB</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTMean</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTSamples</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabelPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tIndPointsLocs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
                    <span class="n">x0</span><span class="o">=</span><span class="n">tIndPointsLocs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">trialToPlot</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">y0</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                    <span class="n">x1</span><span class="o">=</span><span class="n">tIndPointsLocs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">trialToPlot</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">y1</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">tIndPointsLocsColor</span><span class="p">,</span>
                        <span class="n">width</span><span class="o">=</span><span class="mi">3</span>
                    <span class="p">),</span>
                <span class="p">),</span>
                <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
                    <span class="n">x0</span><span class="o">=</span><span class="n">eIndPointsLocs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">trialToPlot</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">y0</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                    <span class="n">x1</span><span class="o">=</span><span class="n">eIndPointsLocs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">trialToPlot</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">y1</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">eIndPointsLocsColor</span><span class="p">,</span>
                        <span class="n">width</span><span class="o">=</span><span class="mi">3</span>
                    <span class="p">),</span>
                <span class="p">),</span>
                <span class="n">row</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">nLatents</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotEstimatedLatentsForTrial"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotEstimatedLatentsForTrial">[docs]</a><span class="k">def</span> <span class="nf">getPlotEstimatedLatentsForTrial</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">latentsMeans</span><span class="p">,</span> <span class="n">latentsSTDs</span><span class="p">,</span> <span class="n">indPointsLocs</span><span class="p">,</span> <span class="n">trialToPlot</span><span class="p">,</span>
                            <span class="n">cbAlpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
                            <span class="n">cbFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                            <span class="n">meanLineColor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                            <span class="n">indPointsLocsColor</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,0.5)&quot;</span><span class="p">,</span>
                            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span>
                            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Latent&quot;</span><span class="p">,</span>
                            <span class="n">titlePattern</span><span class="o">=</span><span class="s2">&quot;Trial </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="n">latentsMeans</span> <span class="o">=</span> <span class="n">latentsMeans</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
    <span class="n">latentsSTDs</span> <span class="o">=</span> <span class="n">latentsSTDs</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
    <span class="n">indPointsLocs</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">indPointsLocs</span><span class="p">]</span>

    <span class="c1"># pio.renderers.default = &quot;browser&quot;</span>
    <span class="n">nLatents</span> <span class="o">=</span> <span class="n">latentsMeans</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">titlePattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trialToPlot</span><span class="p">)</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="n">latentsMeans</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">):</span>
        <span class="n">meanToPlot</span> <span class="o">=</span> <span class="n">latentsMeans</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">,:,</span><span class="n">k</span><span class="p">]</span>
        <span class="n">stdToPlot</span> <span class="o">=</span> <span class="n">latentsSTDs</span><span class="p">[</span><span class="n">trialToPlot</span><span class="p">,:,</span><span class="n">k</span><span class="p">]</span>
        <span class="n">ciToPlot</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">stdToPlot</span>

        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">meanToPlot</span><span class="o">+</span><span class="n">ciToPlot</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">meanToPlot</span><span class="o">+</span><span class="n">ciToPlot</span><span class="p">))</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">meanToPlot</span><span class="o">-</span><span class="n">ciToPlot</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">meanToPlot</span><span class="o">-</span><span class="n">ciToPlot</span><span class="p">))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">times</span>
        <span class="n">x_rev</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">meanToPlot</span>
        <span class="n">y_upper</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">ciToPlot</span>
        <span class="n">y_lower</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">ciToPlot</span>
        <span class="n">y_lower</span> <span class="o">=</span> <span class="n">y_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">y_upper</span> <span class="o">=</span> <span class="n">y_upper</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">y_lower</span> <span class="o">=</span> <span class="n">y_lower</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="n">traceCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">x_rev</span><span class="p">)),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">y_upper</span><span class="p">,</span> <span class="n">y_lower</span><span class="p">)),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="n">cbFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cbAlpha</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">traceMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
            <span class="c1"># line=dict(color=&quot;rgb(0,100,80)&quot;),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">meanLineColor</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceCB</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceMean</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">indPointsLocs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
                    <span class="n">x0</span><span class="o">=</span><span class="n">indPointsLocs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">trialToPlot</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">y0</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                    <span class="n">x1</span><span class="o">=</span><span class="n">indPointsLocs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">trialToPlot</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">y1</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">indPointsLocsColor</span><span class="p">,</span>
                        <span class="n">width</span><span class="o">=</span><span class="mi">3</span>
                    <span class="p">),</span>
                <span class="p">),</span>
            <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getPlotLatentAcrossTrials"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotLatentAcrossTrials">[docs]</a><span class="k">def</span> <span class="nf">getPlotLatentAcrossTrials</span><span class="p">(</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">latentsMeans</span><span class="p">,</span> <span class="n">latentsSTDs</span><span class="p">,</span> <span class="n">latentToPlot</span><span class="p">,</span>
        <span class="n">trials_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">indPointsLocs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cbAlpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="n">indPointsLocsColor</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,0.5)&quot;</span><span class="p">,</span>
        <span class="n">trials_colors_patterns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">default_trial_color_pattern</span><span class="o">=</span><span class="s2">&quot;rgba(128,128,128,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
        <span class="n">cb_transparency</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">mean_transparency</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">titlePattern</span><span class="o">=</span><span class="s2">&quot;Latent </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="c1"># times = times.detach().numpy()</span>
    <span class="n">latentsMeans</span> <span class="o">=</span> <span class="n">latentsMeans</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">latentsSTDs</span> <span class="o">=</span> <span class="n">latentsSTDs</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">indPointsLocs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indPointsLocs</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">indPointsLocs</span><span class="p">]</span>

    <span class="c1"># pio.renderers.default = &quot;browser&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">titlePattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">latentToPlot</span><span class="p">)</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="n">latentsMeans</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="n">trial_times</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">meanToPlot</span> <span class="o">=</span> <span class="n">latentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:,</span> <span class="n">latentToPlot</span><span class="p">]</span>
        <span class="n">stdToPlot</span> <span class="o">=</span> <span class="n">latentsSTDs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:,</span> <span class="n">latentToPlot</span><span class="p">]</span>
        <span class="n">ciToPlot</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">stdToPlot</span>
        <span class="k">if</span> <span class="n">trials_colors_patterns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trial_color_pattern</span> <span class="o">=</span> <span class="n">trials_colors_patterns</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trial_color_pattern</span> <span class="o">=</span> <span class="n">default_trial_color_pattern</span>

        <span class="c1"># pdb.set_trace()</span>
<span class="c1">#         import matplotlib</span>
<span class="c1">#         matplotlib.use(&#39;TkAgg&#39;)</span>
<span class="c1">#         import matplotlib.pyplot as plt</span>
<span class="c1">#         plt.plot(times, meanToPlot)</span>
<span class="c1">#         plt.show()</span>
<span class="c1">#         pdb.set_trace()</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">trial_times</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">meanToPlot</span>
        <span class="n">y_upper</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">ciToPlot</span>
        <span class="n">y_lower</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">ciToPlot</span>
<span class="c1">#         ymax = max(np.max(meanToPlot+ciToPlot), np.max(meanToPlot+ciToPlot))</span>
<span class="c1">#         ymin = min(np.min(meanToPlot-ciToPlot), np.min(meanToPlot-ciToPlot))</span>

        <span class="n">traceCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">y_upper</span><span class="p">,</span> <span class="n">y_lower</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="n">trial_color_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cb_transparency</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">trial_color_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">legendgroup</span><span class="o">=</span><span class="s2">&quot;trial</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">trials_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trial_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trial_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">traceMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">trial_color_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean_transparency</span><span class="p">)),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trial </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trial_label</span><span class="p">),</span>
            <span class="n">legendgroup</span><span class="o">=</span><span class="s2">&quot;trial</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceCB</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceMean</span><span class="p">)</span>

<span class="c1">#         if not indPointsLocs is None:</span>
<span class="c1">#             for n in range(indPointsLocs[latentToPlot].shape[1]):</span>
<span class="c1">#                 fig.add_shape(</span>
<span class="c1">#                     dict(</span>
<span class="c1">#                         type=&quot;line&quot;,</span>
<span class="c1">#                         x0=indPointsLocs[latentToPlot][r,n,0],</span>
<span class="c1">#                         y0=ymin,</span>
<span class="c1">#                         x1=indPointsLocs[latentToPlot][r,n,0],</span>
<span class="c1">#                         y1=ymax,</span>
<span class="c1">#                         line=dict(</span>
<span class="c1">#                             color=color_rgba_pattern.format(0.7),</span>
<span class="c1">#                             width=3</span>
<span class="c1">#                         ),</span>
<span class="c1">#                     ),</span>
<span class="c1">#                 )</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getPlotOrthonormalizedLatentAcrossTrials"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotOrthonormalizedLatentAcrossTrials">[docs]</a><span class="k">def</span> <span class="nf">getPlotOrthonormalizedLatentAcrossTrials</span><span class="p">(</span>
        <span class="n">trials_times</span><span class="p">,</span> <span class="n">latentsMeans</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">trials_ids</span><span class="p">,</span>
        <span class="n">latentToPlot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">align_event_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marked_events_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marked_events_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marked_events_markers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marked_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">trials_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">default_trial_color</span><span class="o">=</span><span class="s2">&quot;rgba(128,128,128)&quot;</span><span class="p">,</span>
        <span class="n">trials_annotations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span>
        <span class="n">titlePattern</span><span class="o">=</span><span class="s2">&quot;Orthonormalized latent </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="c1"># times = times.detach().numpy()</span>
    <span class="c1"># latentsMeans = latentsMeans.detach().numpy()</span>
    <span class="c1"># C = C.detach().numpy()</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">latentsMeans</span><span class="p">)</span>
    <span class="n">oLatentsMeans</span> <span class="o">=</span> <span class="n">svGPFA</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">miscUtils</span><span class="o">.</span><span class="n">orthonormalizeLatentsMeans</span><span class="p">(</span>
        <span class="n">latents_means</span><span class="o">=</span><span class="n">latentsMeans</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">latents_max</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">Inf</span>
        <span class="n">latents_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">Inf</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">oLatentsMeansr_min</span> <span class="o">=</span> <span class="n">oLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">oLatentsMeansr_max</span> <span class="o">=</span> <span class="n">oLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">oLatentsMeansr_min</span> <span class="o">&lt;</span> <span class="n">latents_min</span><span class="p">:</span>
                <span class="n">latents_min</span> <span class="o">=</span> <span class="n">oLatentsMeansr_min</span>
            <span class="k">if</span> <span class="n">oLatentsMeansr_max</span> <span class="o">&gt;</span> <span class="n">latents_max</span><span class="p">:</span>
                <span class="n">latents_max</span> <span class="o">=</span> <span class="n">oLatentsMeansr_max</span>
    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="n">latents_min</span><span class="p">,</span> <span class="n">latents_max</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">titlePattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">latentToPlot</span><span class="p">)</span>

    <span class="n">hover_texts</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Trial: </span><span class="si">{:02d}</span><span class="s2">&lt;br&gt;Time: </span><span class="si">{:f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trial_id</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trials_times</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])]</span>
                   <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">trial_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">trials_annotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
            <span class="n">n_times</span> <span class="o">=</span> <span class="n">trials_times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">an_annotation</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">trial_annotation_key</span> <span class="ow">in</span> <span class="n">trials_annotations</span><span class="p">:</span>
                <span class="n">an_annotation</span> <span class="o">+=</span> <span class="s2">&quot;&lt;br&gt;</span><span class="si">{:s}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">trial_annotation_key</span><span class="p">,</span>
                    <span class="n">trials_annotations</span><span class="p">[</span><span class="n">trial_annotation_key</span><span class="p">][</span><span class="n">r</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_times</span><span class="p">):</span>
                <span class="n">hover_texts</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hover_texts</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">an_annotation</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="n">meanToPlot</span> <span class="o">=</span> <span class="n">oLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">latentToPlot</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">trials_colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trial_color</span> <span class="o">=</span> <span class="n">trials_colors</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trial_color</span> <span class="o">=</span> <span class="n">default_trial_color</span>

        <span class="n">trial_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="n">traceMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">trials_times</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">meanToPlot</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">trial_color</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trial </span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">]),</span>
            <span class="n">legendgroup</span><span class="o">=</span><span class="s2">&quot;trial</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">]),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="n">hover_texts</span><span class="p">[</span><span class="n">r</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceMean</span><span class="p">)</span>

        <span class="c1"># add markers to trials</span>
        <span class="k">if</span> <span class="n">marked_events_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                <span class="n">marked_events_colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                <span class="n">marked_events_markers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                <span class="n">align_event_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_marked_events</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">marked_events_times</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="n">marked_events_times_centered</span> <span class="o">=</span> <span class="n">marked_events_times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">-</span><span class="n">align_event_times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_marked_events</span><span class="p">):</span>
                <span class="n">marked_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                    <span class="n">trials_times</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">marked_events_times_centered</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

                <span class="n">trace_marker</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">trials_times</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">marked_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                    <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">meanToPlot</span><span class="p">[</span><span class="n">marked_index</span><span class="p">]],</span>
                    <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">marked_events_colors</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">symbol</span><span class="o">=</span><span class="n">marked_events_markers</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">size</span><span class="o">=</span><span class="n">marked_size</span><span class="p">),</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span>
                    <span class="n">legendgroup</span><span class="o">=</span><span class="s2">&quot;trial</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">]),</span>
                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_marker</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="get3DPlotOrthonormalizedLatentsAcrossTrials"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.get3DPlotOrthonormalizedLatentsAcrossTrials">[docs]</a><span class="k">def</span> <span class="nf">get3DPlotOrthonormalizedLatentsAcrossTrials</span><span class="p">(</span>
        <span class="n">trials_times</span><span class="p">,</span> <span class="n">latentsMeans</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">trials_ids</span><span class="p">,</span>
        <span class="n">latentsToPlot</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">align_event_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marked_events_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marked_events_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marked_events_markers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marked_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">trials_annotations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">trials_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_trial_color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
        <span class="n">xyzLabelsPattern</span><span class="o">=</span><span class="s2">&quot;Latent </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">latentsMeans</span><span class="p">)</span>

    <span class="n">oLatentsMeans</span> <span class="o">=</span> <span class="n">svGPFA</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">miscUtils</span><span class="o">.</span><span class="n">orthonormalizeLatentsMeans</span><span class="p">(</span>
        <span class="n">latents_means</span><span class="o">=</span><span class="n">latentsMeans</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">)</span>

    <span class="n">hover_texts</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Trial: </span><span class="si">{:02d}</span><span class="s2">&lt;br&gt;Time: </span><span class="si">{:f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trial_id</span><span class="p">,</span> <span class="n">trial_time</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trial_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trials_times</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])]</span>
                   <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">trial_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="n">n_times</span> <span class="o">=</span> <span class="n">trials_times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">an_annotation</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">trials_annotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">trial_annotation_key</span> <span class="ow">in</span> <span class="n">trials_annotations</span><span class="p">:</span>
                <span class="n">an_annotation</span> <span class="o">+=</span> <span class="s2">&quot;&lt;br&gt;</span><span class="si">{:s}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">trial_annotation_key</span><span class="p">,</span>
                    <span class="n">trials_annotations</span><span class="p">[</span><span class="n">trial_annotation_key</span><span class="p">][</span><span class="n">r</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_times</span><span class="p">):</span>
                <span class="n">hover_texts</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hover_texts</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">an_annotation</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">trials_colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">latent_color</span> <span class="o">=</span> <span class="n">trials_colors</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">latent_color</span> <span class="o">=</span> <span class="n">default_trial_color</span>

        <span class="n">trace_latent_mean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">oLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">latentsToPlot</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">oLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">latentsToPlot</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="n">z</span><span class="o">=</span><span class="n">oLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">latentsToPlot</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">latent_color</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trial </span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">]),</span>
            <span class="n">legendgroup</span><span class="o">=</span><span class="s2">&quot;trial</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">]),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="n">hover_texts</span><span class="p">[</span><span class="n">r</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_latent_mean</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">marked_events_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
           <span class="n">marked_events_colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
           <span class="n">marked_events_markers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
           <span class="n">align_event_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_marked_events</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">marked_events_times</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="n">marked_events_times_centered</span> <span class="o">=</span> <span class="n">marked_events_times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">-</span><span class="n">align_event_times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_marked_events</span><span class="p">):</span>
                <span class="n">marked_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                    <span class="n">trials_times</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">marked_events_times_centered</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

                <span class="n">trace_marker</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">oLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">marked_index</span><span class="p">,</span> <span class="n">latentsToPlot</span><span class="p">[</span><span class="mi">0</span><span class="p">]]],</span>
                    <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">oLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">marked_index</span><span class="p">,</span> <span class="n">latentsToPlot</span><span class="p">[</span><span class="mi">1</span><span class="p">]]],</span>
                    <span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="n">oLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">marked_index</span><span class="p">,</span> <span class="n">latentsToPlot</span><span class="p">[</span><span class="mi">2</span><span class="p">]]],</span>
                    <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">marked_events_colors</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">symbol</span><span class="o">=</span><span class="n">marked_events_markers</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">size</span><span class="o">=</span><span class="n">marked_size</span><span class="p">),</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span>
                    <span class="n">legendgroup</span><span class="o">=</span><span class="s2">&quot;trial</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">]),</span>
                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_marker</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="n">xyzLabelsPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">latentsToPlot</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="n">xyzLabelsPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">latentsToPlot</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">zaxis_title</span><span class="o">=</span><span class="n">xyzLabelsPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">latentsToPlot</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getPlotOrthonormalizedLatentImageOneNeuronAllTrials"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotOrthonormalizedLatentImageOneNeuronAllTrials">[docs]</a><span class="k">def</span> <span class="nf">getPlotOrthonormalizedLatentImageOneNeuronAllTrials</span><span class="p">(</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">latentsMeans</span><span class="p">,</span> <span class="n">latentToPlot</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span>
        <span class="n">sort_event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">align_event_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">marked_events</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">trials_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trials_annotations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Trial Index&quot;</span><span class="p">,</span>
        <span class="n">event_line_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">event_line_width</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c1"># times = times.detach().numpy()</span>
    <span class="c1"># latentsMeans = latentsMeans.detach().numpy()</span>
    <span class="c1"># C = C.detach().numpy()</span>
    <span class="c1"># creating latents orthonormalization matrix</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">latentsMeans</span><span class="p">)</span>
    <span class="n">nTimes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
    <span class="n">oLatentsMeans</span> <span class="o">=</span> <span class="n">svGPFA</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">miscUtils</span><span class="o">.</span><span class="n">orthonormalizeLatentsMeans</span><span class="p">(</span>
        <span class="n">latents_means</span><span class="o">=</span><span class="n">latentsMeans</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">zlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">latents_max</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">Inf</span>
        <span class="n">latents_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">Inf</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">zlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">oLatentsMeansr_min</span> <span class="o">=</span> <span class="n">oLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">oLatentsMeansr_max</span> <span class="o">=</span> <span class="n">oLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">oLatentsMeansr_min</span> <span class="o">&lt;</span> <span class="n">latents_min</span><span class="p">:</span>
                <span class="n">latents_min</span> <span class="o">=</span> <span class="n">oLatentsMeansr_min</span>
            <span class="k">if</span> <span class="n">oLatentsMeansr_max</span> <span class="o">&gt;</span> <span class="n">latents_max</span><span class="p">:</span>
                <span class="n">latents_max</span> <span class="o">=</span> <span class="n">oLatentsMeansr_max</span>
    <span class="k">if</span> <span class="n">zlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">zlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">latents_min</span><span class="p">,</span> <span class="n">latents_max</span><span class="p">]</span>
    <span class="c1"># pio.renderers.default = &quot;browser&quot;</span>
    <span class="n">latents_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_trials</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)))</span>
    <span class="c1"># creating orthonormalized latents_image</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="c1"># meanToPlot = latentsMeans[r][latentToPlot,:]</span>
        <span class="c1"># oTrialLatentsMean = np.matmul(latentsMeans[r], orthoMatrix)</span>
        <span class="n">latents_image</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">oLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">latentToPlot</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">align_event_times</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># align_event_times = np.zeros(shape=(len(sort_event), 1))</span>
        <span class="n">align_event_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_trials</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">sorted_trials_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trials_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">trials_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">trial_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">trial_id</span> <span class="ow">in</span> <span class="n">trials_ids</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">trials_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_trials_indices</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">sort_event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sort_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sort_event</span><span class="o">-</span><span class="n">align_event_times</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">latents_image</span> <span class="o">=</span> <span class="n">latents_image</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">trials_labels</span> <span class="o">=</span> <span class="n">trials_labels</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">]</span>
        <span class="n">marked_events</span> <span class="o">=</span> <span class="n">marked_events</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">align_event_times</span> <span class="o">=</span> <span class="n">align_event_times</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">]</span>
    <span class="n">hover_text</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Trial: </span><span class="si">{:s}</span><span class="s2">&lt;br&gt;Time: </span><span class="si">{:f}</span><span class="s2">&lt;br&gt;Amplitude: </span><span class="si">{:f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trial_label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">latents_image</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> 
                   <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">times</span><span class="p">)]</span> 
                  <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">trial_label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trials_labels</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">trials_annotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sort_event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">trial_annotation_key</span> <span class="ow">in</span> <span class="n">trials_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">trials_annotations</span><span class="p">[</span><span class="n">trial_annotation_key</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">trials_annotations</span><span class="p">[</span><span class="n">trial_annotation_key</span><span class="p">][</span><span class="n">sort_indices</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
            <span class="n">an_annotation</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">trial_annotation_key</span> <span class="ow">in</span> <span class="n">trials_annotations</span><span class="p">:</span>
                <span class="n">an_annotation</span> <span class="o">+=</span> <span class="s2">&quot;&lt;br&gt;</span><span class="si">{:s}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trial_annotation_key</span><span class="p">,</span> <span class="n">trials_annotations</span><span class="p">[</span><span class="n">trial_annotation_key</span><span class="p">][</span><span class="n">r</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTimes</span><span class="p">):</span>
                <span class="n">hover_text</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hover_text</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">an_annotation</span>
    <span class="c1"># import pdb; pdb.set_trace()</span>
    <span class="n">trace_hm</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">times</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="n">sorted_trials_indices</span><span class="p">,</span>
                          <span class="n">z</span><span class="o">=</span><span class="n">latents_image</span><span class="p">,</span>
                          <span class="n">zmin</span><span class="o">=</span><span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                          <span class="n">zmax</span><span class="o">=</span><span class="n">zlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                          <span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                          <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_hm</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">marked_events</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_marked_events</span> <span class="o">=</span> <span class="n">marked_events</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n_marked_events</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">min_time</span> <span class="o">=</span> <span class="n">times</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">max_time</span> <span class="o">=</span> <span class="n">times</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_marked_events</span><span class="p">):</span>
        <span class="n">marked_times</span> <span class="o">=</span> <span class="n">marked_events</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">align_event_times</span>
        <span class="n">marked_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">marked_times</span><span class="o">&lt;</span><span class="n">min_time</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">marked_times</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">min_time</span><span class="p">,</span>
                                <span class="n">marked_times</span><span class="p">)</span>
        <span class="n">marked_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">marked_times</span><span class="o">&gt;</span><span class="n">max_time</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">marked_times</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">max_time</span><span class="p">,</span>
                                <span class="n">marked_times</span><span class="p">)</span>
        <span class="n">trace_event</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">marked_times</span><span class="p">,</span>
                                 <span class="n">y</span><span class="o">=</span><span class="n">sorted_trials_indices</span><span class="p">,</span>
                                 <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">event_line_color</span><span class="p">,</span>
                                           <span class="n">width</span><span class="o">=</span><span class="n">event_line_width</span><span class="p">),</span>
                                 <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_event</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getPlotTrueAndEstimatedLatentsOneTrialOneLatent"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedLatentsOneTrialOneLatent">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedLatentsOneTrialOneLatent</span><span class="p">(</span>
    <span class="n">tTimes</span><span class="p">,</span> <span class="n">tLatentsSamples</span><span class="p">,</span> <span class="n">tLatentsMeans</span><span class="p">,</span> <span class="n">tLatentsSTDs</span><span class="p">,</span> <span class="n">tIndPointsLocs</span><span class="p">,</span>
    <span class="n">eTimes</span><span class="p">,</span> <span class="n">eLatentsMeans</span><span class="p">,</span> <span class="n">eLatentsSTDs</span><span class="p">,</span> <span class="n">eIndPointsLocs</span><span class="p">,</span>
    <span class="n">title</span><span class="p">,</span>
    <span class="n">CBalpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">tCBFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,255,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="n">tSamplesLineColor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="n">tMeanLineColor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="n">eCBFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="n">eMeanLineColor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="n">tIndPointsLocsColor</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,255,0.5)&quot;</span><span class="p">,</span>
    <span class="n">eIndPointsLocsColor</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,0.5)&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Latent Value&quot;</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="n">tCI</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">tLatentsSTDs</span>
    <span class="n">eCI</span> <span class="o">=</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">eLatentsSTDs</span>

    <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tLatentsMeans</span><span class="o">+</span><span class="n">tCI</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eLatentsMeans</span><span class="o">+</span><span class="n">eCI</span><span class="p">))</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tLatentsMeans</span><span class="o">-</span><span class="n">tCI</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eLatentsMeans</span><span class="o">-</span><span class="n">eCI</span><span class="p">))</span>

    <span class="n">xE</span> <span class="o">=</span> <span class="n">eTimes</span>
    <span class="n">xE_rev</span> <span class="o">=</span> <span class="n">xE</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">yE</span> <span class="o">=</span> <span class="n">eLatentsMeans</span>
    <span class="n">yE_upper</span> <span class="o">=</span> <span class="n">yE</span> <span class="o">+</span> <span class="n">eCI</span>
    <span class="n">yE_lower</span> <span class="o">=</span> <span class="n">yE</span> <span class="o">-</span> <span class="n">eCI</span>
    <span class="n">yE_lower</span> <span class="o">=</span> <span class="n">yE_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">xE</span> <span class="o">=</span> <span class="n">xE</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yE</span> <span class="o">=</span> <span class="n">yE</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yE_upper</span> <span class="o">=</span> <span class="n">yE_upper</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yE_lower</span> <span class="o">=</span> <span class="n">yE_lower</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">xT</span> <span class="o">=</span> <span class="n">tTimes</span>
    <span class="n">xT_rev</span> <span class="o">=</span> <span class="n">xT</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">yT</span> <span class="o">=</span> <span class="n">tLatentsMeans</span>
    <span class="n">yTSamples</span> <span class="o">=</span> <span class="n">tLatentsSamples</span>
    <span class="n">yT_upper</span> <span class="o">=</span> <span class="n">yT</span> <span class="o">+</span> <span class="n">tCI</span>
    <span class="n">yT_lower</span> <span class="o">=</span> <span class="n">yT</span> <span class="o">-</span> <span class="n">tCI</span>
    <span class="n">yT_lower</span> <span class="o">=</span> <span class="n">yT_lower</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">xT</span> <span class="o">=</span> <span class="n">xT</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yT</span> <span class="o">=</span> <span class="n">yT</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yTSamples</span> <span class="o">=</span> <span class="n">yTSamples</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yT_upper</span> <span class="o">=</span> <span class="n">yT_upper</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">yT_lower</span> <span class="o">=</span> <span class="n">yT_lower</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">traceECB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xE</span><span class="p">,</span> <span class="n">xE_rev</span><span class="p">)),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yE_upper</span><span class="p">,</span> <span class="n">yE_lower</span><span class="p">)),</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="n">eCBFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CBalpha</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceEMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xE</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yE</span><span class="p">,</span>
        <span class="c1"># line=dict(color=&quot;rgb(0,100,80)&quot;),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">eMeanLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceTCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xT</span><span class="p">,</span> <span class="n">xT_rev</span><span class="p">)),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yT_upper</span><span class="p">,</span> <span class="n">yT_lower</span><span class="p">)),</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="n">tCBFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CBalpha</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceTMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xT</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yT</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">tMeanLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceTSamples</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xT</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">yTSamples</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">tSamplesLineColor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceECB</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceEMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTCB</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTSamples</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tIndPointsLocs</span><span class="p">)):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
                <span class="n">x0</span><span class="o">=</span><span class="n">tIndPointsLocs</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
                <span class="n">y0</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">x1</span><span class="o">=</span><span class="n">tIndPointsLocs</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
                <span class="n">y1</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">tIndPointsLocsColor</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">3</span>
                <span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
                <span class="n">x0</span><span class="o">=</span><span class="n">eIndPointsLocs</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
                <span class="n">y0</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">x1</span><span class="o">=</span><span class="n">eIndPointsLocs</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
                <span class="n">y1</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">eIndPointsLocsColor</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">3</span>
                <span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotTrueAndEstimatedLatentsMeans"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedLatentsMeans">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedLatentsMeans</span><span class="p">(</span><span class="n">trueLatentsMeans</span><span class="p">,</span> 
                                        <span class="n">estimatedLatentsMeans</span><span class="p">,</span>
                                        <span class="n">trialsTimes</span><span class="p">,</span> 
                                        <span class="n">colorTrue</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                        <span class="n">colorEstimated</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                        <span class="n">labelTrue</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
                                        <span class="n">labelEstimated</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
                                        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span>
                                        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Latent Value&quot;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getTracesOneSetTrueAndEstimatedLatentsMeans</span><span class="p">(</span>
        <span class="n">trueLatentMean</span><span class="p">,</span>
        <span class="n">estimatedLatentMean</span><span class="p">,</span>
        <span class="n">times</span><span class="p">,</span>
        <span class="n">labelTrue</span><span class="p">,</span> <span class="n">labelEstimated</span><span class="p">,</span>
        <span class="n">useLegend</span><span class="p">):</span>
        <span class="n">traceTrue</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">times</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">trueLatentMean</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">labelTrue</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colorTrue</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
        <span class="n">traceEstimated</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">times</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">estimatedLatentMean</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">labelEstimated</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colorEstimated</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">traceTrue</span><span class="p">,</span> <span class="n">traceEstimated</span>

    <span class="c1"># trueLatentsMeans[r] \in nLatents x nInd[k]</span>
    <span class="c1"># qMu[k] \in n_trials x nInd[k] x 1</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trueLatentsMeans</span><span class="p">)</span>
    <span class="n">nLatents</span> <span class="o">=</span> <span class="n">trueLatentsMeans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">subplots</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">nLatents</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">trialsTimes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">):</span>
            <span class="n">trueLatentMean</span> <span class="o">=</span> <span class="n">trueLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">k</span><span class="p">,:]</span>
            <span class="n">estimatedLatentMean</span> <span class="o">=</span> <span class="n">estimatedLatentsMeans</span><span class="p">[</span><span class="n">r</span><span class="p">,:,</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">==</span><span class="n">nLatents</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">useLegend</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">useLegend</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">traceTrue</span><span class="p">,</span> <span class="n">traceEstimated</span> <span class="o">=</span> <span class="n">getTracesOneSetTrueAndEstimatedLatentsMeans</span><span class="p">(</span>
                <span class="n">trueLatentMean</span><span class="o">=</span><span class="n">trueLatentMean</span><span class="p">,</span>
                <span class="n">estimatedLatentMean</span><span class="o">=</span><span class="n">estimatedLatentMean</span><span class="p">,</span>
                <span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span>
                <span class="n">labelTrue</span><span class="o">=</span><span class="n">labelTrue</span><span class="p">,</span>
                <span class="n">labelEstimated</span><span class="o">=</span><span class="n">labelEstimated</span><span class="p">,</span>
                <span class="n">useLegend</span><span class="o">=</span><span class="n">useLegend</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTrue</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceEstimated</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">n_trials</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">nLatents</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getSimulatedLatentsPlot"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getSimulatedLatentsPlot">[docs]</a><span class="k">def</span> <span class="nf">getSimulatedLatentsPlot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">latents_samples</span><span class="p">,</span> <span class="n">latents_means</span><span class="p">,</span>
                            <span class="n">latents_STDs</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
                            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">,</span>
                            <span class="n">width</span><span class="o">=</span><span class="mi">1250</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">850</span><span class="p">,</span>
                            <span class="n">cb_fillcolor_pattern</span><span class="o">=</span><span class="s2">&quot;rgba(0,100,0,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                            <span class="n">meanLineColor</span><span class="o">=</span><span class="s2">&quot;rgb(0,100,00)&quot;</span><span class="p">,</span>
                            <span class="n">samplesLineColor</span><span class="o">=</span><span class="s2">&quot;rgb(0,0,0)&quot;</span><span class="p">):</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">latents_samples</span><span class="p">)</span>
    <span class="n">nLatents</span> <span class="o">=</span> <span class="n">latents_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">subplotsTitles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;trial=</span><span class="si">{:d}</span><span class="s2">, latent=</span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">)]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">subplots</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">nLatents</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="n">subplotsTitles</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">t_rev</span> <span class="o">=</span> <span class="n">t</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">):</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">latents_samples</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">latents_means</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">latents_STDs</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">mean</span><span class="o">+</span><span class="mf">1.96</span><span class="o">*</span><span class="n">std</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">mean</span><span class="o">-</span><span class="mf">1.96</span><span class="o">*</span><span class="n">std</span>
            <span class="n">lower_rev</span> <span class="o">=</span> <span class="n">lower</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">traceCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">t_rev</span><span class="p">)),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">upper</span><span class="p">,</span> <span class="n">lower_rev</span><span class="p">)),</span>
                <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
                <span class="n">fillcolor</span><span class="o">=</span><span class="n">cb_fillcolor_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">traceMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">mean_linecolor</span><span class="p">),</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">traceSamples</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">samplesLineColor</span><span class="p">),</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceCB</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceMean</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceSamples</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="n">n_trials</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">k</span><span class="o">==</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">nLatents</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n_trials</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">autosize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getSimulatedLatentPlot"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getSimulatedLatentPlot">[docs]</a><span class="k">def</span> <span class="nf">getSimulatedLatentPlot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">latent_samples</span><span class="p">,</span> <span class="n">latent_means</span><span class="p">,</span>
                           <span class="n">latent_STDs</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
                           <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span>
                           <span class="n">cbFillColorPattern</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,255,</span><span class="si">{:f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                           <span class="n">mean_linecolor</span><span class="o">=</span><span class="s2">&quot;rgb(0,0,255)&quot;</span><span class="p">,</span>
                           <span class="n">samples_linecolor</span><span class="o">=</span><span class="s2">&quot;rgb(0,0,0)&quot;</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">times</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">t_rev</span> <span class="o">=</span> <span class="n">t</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">latent_samples</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">latent_means</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">latent_STDs</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">mean</span><span class="o">+</span><span class="mf">1.96</span><span class="o">*</span><span class="n">std</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">mean</span><span class="o">-</span><span class="mf">1.96</span><span class="o">*</span><span class="n">std</span>
    <span class="n">lower_rev</span> <span class="o">=</span> <span class="n">lower</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">anX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">t_rev</span><span class="p">))</span>
    <span class="n">anY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">upper</span><span class="p">,</span> <span class="n">lower_rev</span><span class="p">))</span>
    <span class="n">traceCB</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">anX</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">anY</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="n">cbFillColorPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(255,255,255,0)&quot;</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">mean_linecolor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mean&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">traceSamples</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">samples_linecolor</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Sample&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceCB</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceMean</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceSamples</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<span class="c1"># kernels</span>
<div class="viewcode-block" id="getPlotTrueAndEstimatedKernelsParams"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedKernelsParams">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedKernelsParams</span><span class="p">(</span><span class="n">kernelsTypes</span><span class="p">,</span> <span class="n">trueKernelsParams</span><span class="p">,</span> <span class="n">estimatedKernelsParams</span><span class="p">,</span>
                                         <span class="n">colorTrue</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                         <span class="n">colorEstimated</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                         <span class="n">trueLegend</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
                                         <span class="n">estimatedLegend</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">):</span>
    <span class="n">nLatents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trueKernelsParams</span><span class="p">)</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Kernel </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">kernelsTypes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">)]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">subplots</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">nLatents</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="n">titles</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">):</span>
        <span class="n">trueParams</span> <span class="o">=</span> <span class="n">trueKernelsParams</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">estimatedParams</span> <span class="o">=</span> <span class="n">estimatedKernelsParams</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">showLegend</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">showLegend</span> <span class="o">=</span> <span class="kc">False</span>


        <span class="k">if</span> <span class="n">kernelsTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;periodic&quot;</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Length Scale&quot;</span><span class="p">,</span> <span class="s2">&quot;Period&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">kernelsTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;exponentialQuadratic&quot;</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Length Scale&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid kernel type </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kernelsTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>

        <span class="n">traceTrue</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">trueParams</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">trueLegend</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="n">colorTrue</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="n">showLegend</span><span class="p">)</span>
        <span class="n">traceEstimated</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">estimatedParams</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">estimatedLegend</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="n">colorEstimated</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="n">showLegend</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">append_trace</span><span class="p">(</span><span class="n">traceTrue</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">append_trace</span><span class="p">(</span><span class="n">traceEstimated</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># import pdb; pdb.set_trace()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Parameter Value&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">nLatents</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotKernelsParams"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotKernelsParams">[docs]</a><span class="k">def</span> <span class="nf">getPlotKernelsParams</span><span class="p">(</span><span class="n">kernelsTypes</span><span class="p">,</span> <span class="n">kernelsParams</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">):</span>
    <span class="n">nLatents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">kernelsParams</span><span class="p">)</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Latent </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">kernelsTypes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">)]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">subplots</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">nLatents</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="n">titles</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">):</span>
        <span class="c1"># params = kernelsParams[k].tolist()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">kernelsParams</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">showLegend</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">showLegend</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">kernelsTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;PeriodicKernel&quot;</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Length Scale&quot;</span><span class="p">,</span> <span class="s2">&quot;Period&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">kernelsTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;ExponentialQuadraticKernel&quot;</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Length Scale&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid kernel type </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kernelsTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">append_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># import pdb; pdb.set_trace()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">nLatents</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotTrueAndEstimatedKernelsParamsOneLatent"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTrueAndEstimatedKernelsParamsOneLatent">[docs]</a><span class="k">def</span> <span class="nf">getPlotTrueAndEstimatedKernelsParamsOneLatent</span><span class="p">(</span>
    <span class="n">trueKernel</span><span class="p">,</span>
    <span class="n">estimatedKernelParams</span><span class="p">,</span>
    <span class="n">title</span><span class="p">,</span>
    <span class="n">colorTrue</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="n">colorEstimated</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="n">trueLegend</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
    <span class="n">estimatedLegend</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">namedParams</span> <span class="o">=</span> <span class="n">trueKernel</span><span class="o">.</span><span class="n">getNamedParams</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">namedParams</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">namedParams</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">trueParams</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">namedParams</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
    <span class="n">estimatedParams</span> <span class="o">=</span> <span class="n">estimatedKernelParams</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">traceTrue</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">trueParams</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">trueLegend</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="n">colorTrue</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">traceEstimated</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">estimatedParams</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">estimatedLegend</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="n">colorEstimated</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceTrue</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceEstimated</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Parameter Value&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotKernelsParamsOneLatent"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotKernelsParamsOneLatent">[docs]</a><span class="k">def</span> <span class="nf">getPlotKernelsParamsOneLatent</span><span class="p">(</span><span class="n">kernelParams</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">):</span>
    <span class="n">kernelParams</span> <span class="o">=</span> <span class="n">kernelParams</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">kernelParams</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Parameter Value&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotTruePythonAndMatlabKernelsParams"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTruePythonAndMatlabKernelsParams">[docs]</a><span class="k">def</span> <span class="nf">getPlotTruePythonAndMatlabKernelsParams</span><span class="p">(</span><span class="n">kernelsTypes</span><span class="p">,</span>
                                            <span class="n">trueKernelsParams</span><span class="p">,</span>
                                            <span class="n">pythonKernelsParams</span><span class="p">,</span>
                                            <span class="n">matlabKernelsParams</span><span class="p">,</span>
                                            <span class="n">colorTrue</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                            <span class="n">colorPython</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                            <span class="n">colorMatlab</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                                            <span class="n">trueLegend</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
                                            <span class="n">pythonLegend</span><span class="o">=</span><span class="s2">&quot;Python&quot;</span><span class="p">,</span>
                                            <span class="n">matlabLegend</span><span class="o">=</span><span class="s2">&quot;Matlab&quot;</span><span class="p">):</span>
    <span class="n">nLatents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trueKernelsParams</span><span class="p">)</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Kernel </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">kernelsTypes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">)]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">subplots</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">nLatents</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="n">titles</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLatents</span><span class="p">):</span>
        <span class="n">trueParams</span> <span class="o">=</span> <span class="n">trueKernelsParams</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">pythonParams</span> <span class="o">=</span> <span class="n">pythonKernelsParams</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">matlabParams</span> <span class="o">=</span> <span class="n">matlabKernelsParams</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">matlabParams</span><span class="p">)</span><span class="o">==</span><span class="nb">float</span><span class="p">:</span>
            <span class="n">matlabParams</span> <span class="o">=</span> <span class="p">[</span><span class="n">matlabParams</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">showLegend</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">showLegend</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">kernelsTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;PeriodicKernel&quot;</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Length Scale&quot;</span><span class="p">,</span> <span class="s2">&quot;Period&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">kernelsTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;ExponentialQuadraticKernel&quot;</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Length Scale&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid kernel type </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kernelsTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>

        <span class="n">traceTrue</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">trueParams</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">trueLegend</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="n">colorTrue</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="n">showLegend</span><span class="p">)</span>
        <span class="n">tracePython</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">pythonParams</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">pythonLegend</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="n">colorPython</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="n">showLegend</span><span class="p">)</span>
        <span class="n">traceMatlab</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">matlabParams</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">matlabLegend</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="n">colorMatlab</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="n">showLegend</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">append_trace</span><span class="p">(</span><span class="n">traceTrue</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">append_trace</span><span class="p">(</span><span class="n">tracePython</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">append_trace</span><span class="p">(</span><span class="n">traceMatlab</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Parameter Value&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">nLatents</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<span class="c1"># CIF</span>
<div class="viewcode-block" id="getPlotTruePythonAndMatlabCIFs"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotTruePythonAndMatlabCIFs">[docs]</a><span class="k">def</span> <span class="nf">getPlotTruePythonAndMatlabCIFs</span><span class="p">(</span><span class="n">tTimes</span><span class="p">,</span> <span class="n">tCIF</span><span class="p">,</span> <span class="n">tLabel</span><span class="p">,</span>
                                   <span class="n">pTimes</span><span class="p">,</span> <span class="n">pCIF</span><span class="p">,</span> <span class="n">pLabel</span><span class="p">,</span>
                                   <span class="n">mTimes</span><span class="p">,</span> <span class="n">mCIF</span><span class="p">,</span> <span class="n">mLabel</span><span class="p">,</span>
                                   <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span>
                                   <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;CIF&quot;</span><span class="p">,</span>
                                   <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                                   <span class="p">):</span>
    <span class="c1"># pio.renderers.default = &quot;browser&quot;</span>
    <span class="n">figDic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;layout&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;xaxis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">xlabel</span><span class="p">},</span>
            <span class="s2">&quot;yaxis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">ylabel</span><span class="p">},</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tLabel</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">tTimes</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">tCIF</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">pLabel</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">pTimes</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">pCIF</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">mLabel</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">mTimes</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">mCIF</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getPlotSimulatedAndEstimatedCIFs"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotSimulatedAndEstimatedCIFs">[docs]</a><span class="k">def</span> <span class="nf">getPlotSimulatedAndEstimatedCIFs</span><span class="p">(</span><span class="n">tTimes</span><span class="p">,</span> <span class="n">tCIF</span><span class="p">,</span> <span class="n">tLabel</span><span class="p">,</span>
                                     <span class="n">eMeanTimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eMeanCIF</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eMeanLabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="c1">#                                      ePosteriorMeanTimes=None, ePosteriorMeanCIF=None, ePosteriorMeanLabel=None,</span>
                                     <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;CIF&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="c1"># pio.renderers.default = &quot;browser&quot;</span>
    <span class="n">figDic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;layout&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;xaxis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">xlabel</span><span class="p">},</span>
            <span class="s2">&quot;yaxis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">ylabel</span><span class="p">},</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tLabel</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">tTimes</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">tCIF</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">eMeanCIF</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">eMeanLabel</span><span class="p">,</span>
                <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">eMeanTimes</span><span class="p">,</span>
                <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">eMeanCIF</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>
<span class="c1">#     if ePosteriorMeanCIF is not None:</span>
<span class="c1">#         figDic[&quot;data&quot;].append(</span>
<span class="c1">#             {</span>
<span class="c1">#                 &quot;type&quot;: &quot;scatter&quot;,</span>
<span class="c1">#                 &quot;name&quot;: ePosteriorMeanLabel,</span>
<span class="c1">#                 &quot;x&quot;: ePosteriorMeanTimes,</span>
<span class="c1">#                 &quot;y&quot;: ePosteriorMeanCIF,</span>
<span class="c1">#             },</span>
<span class="c1">#         )</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getPlotCIF"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotCIF">[docs]</a><span class="k">def</span> <span class="nf">getPlotCIF</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Conditional Intensity Function&quot;</span><span class="p">):</span>
    <span class="n">figDic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;layout&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
            <span class="s2">&quot;xaxis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">xlabel</span><span class="p">},</span>
            <span class="s2">&quot;yaxis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">ylabel</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">times</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">values</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">figDic</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getPlotCIFsImageOneNeuronAllTrials"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotCIFsImageOneNeuronAllTrials">[docs]</a><span class="k">def</span> <span class="nf">getPlotCIFsImageOneNeuronAllTrials</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">cif_values</span><span class="p">,</span> <span class="n">neuron_index</span><span class="p">,</span>
                                       <span class="n">sort_event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">align_event_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                       <span class="n">marked_events</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                       <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span>
                                       <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Sorted Trial Index&quot;</span><span class="p">,</span>
                                       <span class="n">event_line_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                                       <span class="n">event_line_width</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c1"># civ_values[trialIndex][neuron_index]</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cif_values</span><span class="p">)</span>
    <span class="n">trials_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">)</span>
    <span class="n">cifs_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_trials</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="n">cifs_image</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">cif_values</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">neuron_index</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">sort_event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sort_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sort_event</span><span class="o">-</span><span class="n">align_event_times</span><span class="p">)</span>
        <span class="n">cifs_image</span> <span class="o">=</span> <span class="n">cifs_image</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">if</span> <span class="n">align_event_times</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">align_event_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trials_indices</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">trace_hm</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">trials_indices</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">cifs_image</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_hm</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">marked_events</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_marked_events</span> <span class="o">=</span> <span class="n">marked_events</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">min_time</span> <span class="o">=</span> <span class="n">times</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">max_time</span> <span class="o">=</span> <span class="n">times</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_marked_events</span><span class="p">):</span>
            <span class="n">marked_times</span> <span class="o">=</span> <span class="n">marked_events</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">align_event_times</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">]</span>
            <span class="n">marked_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">marked_times</span><span class="o">&lt;</span><span class="n">min_time</span><span class="p">,</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">marked_times</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">min_time</span><span class="p">,</span>
                                    <span class="n">marked_times</span><span class="p">)</span>
            <span class="n">marked_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">marked_times</span><span class="o">&gt;</span><span class="n">max_time</span><span class="p">,</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">marked_times</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">max_time</span><span class="p">,</span>
                                    <span class="n">marked_times</span><span class="p">)</span>
            <span class="n">trace_event</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">marked_times</span><span class="p">,</span>
                                    <span class="n">y</span><span class="o">=</span><span class="n">trials_indices</span><span class="p">,</span>
                                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">event_line_color</span><span class="p">,</span>
                                            <span class="n">width</span><span class="o">=</span><span class="n">event_line_width</span><span class="p">),</span>
                                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_event</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getPlotCIFsOneNeuronAllTrials"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotCIFsOneNeuronAllTrials">[docs]</a><span class="k">def</span> <span class="nf">getPlotCIFsOneNeuronAllTrials</span><span class="p">(</span>
        <span class="n">trials_times</span><span class="p">,</span> <span class="n">cif_values</span><span class="p">,</span> <span class="n">neuron_index</span><span class="p">,</span> <span class="n">trials_ids</span><span class="p">,</span>
        <span class="n">spikes_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">align_event_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marked_events_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marked_events_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marked_events_markers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marked_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">trials_annotations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">trials_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_trial_color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>

    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cif_values</span><span class="p">)</span>
    <span class="n">n_times</span> <span class="o">=</span> <span class="n">trials_times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cif_values_max</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">Inf</span>
        <span class="n">cif_values_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">Inf</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cif_valuesr_min</span> <span class="o">=</span> <span class="n">cif_values</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">neuron_index</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">cif_valuesr_max</span> <span class="o">=</span> <span class="n">cif_values</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">neuron_index</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">cif_valuesr_min</span> <span class="o">&lt;</span> <span class="n">cif_values_min</span><span class="p">:</span>
                    <span class="n">cif_values_min</span> <span class="o">=</span> <span class="n">cif_valuesr_min</span>
                <span class="k">if</span> <span class="n">cif_valuesr_max</span> <span class="o">&gt;</span> <span class="n">cif_values_max</span><span class="p">:</span>
                    <span class="n">cif_values_max</span> <span class="o">=</span> <span class="n">cif_valuesr_max</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="n">cif_values_min</span><span class="p">,</span> <span class="n">cif_values_max</span><span class="p">]</span>

    <span class="n">hover_text</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Trial: </span><span class="si">{:02d}</span><span class="s2">&lt;br&gt;Time: </span><span class="si">{:f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trial_id</span><span class="p">,</span> <span class="n">trial_time</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trial_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trials_times</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])]</span>
                  <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">trial_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="n">an_annotation</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">trials_annotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">trial_annotation_key</span> <span class="ow">in</span> <span class="n">trials_annotations</span><span class="p">:</span>
                <span class="n">an_annotation</span> <span class="o">+=</span> <span class="s2">&quot;&lt;br&gt;</span><span class="si">{:s}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">trial_annotation_key</span><span class="p">,</span>
                    <span class="n">trials_annotations</span><span class="p">[</span><span class="n">trial_annotation_key</span><span class="p">][</span><span class="n">r</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_times</span><span class="p">):</span>
                <span class="n">hover_text</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hover_text</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">an_annotation</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">trials_colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cif_color</span> <span class="o">=</span> <span class="n">trials_colors</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cif_color</span> <span class="o">=</span> <span class="n">default_trial_color</span>

        <span class="n">cifToPlot</span> <span class="o">=</span> <span class="n">cif_values</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">neuron_index</span><span class="p">]</span>
        <span class="n">traceMean</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">trials_times</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">cifToPlot</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">cif_color</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trial </span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">]),</span>
            <span class="n">legendgroup</span><span class="o">=</span><span class="s2">&quot;trial</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">]),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">[</span><span class="n">r</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">traceMean</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">marked_events_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
           <span class="n">marked_events_colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
           <span class="n">marked_events_markers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
           <span class="n">align_event_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_marked_events</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">marked_events_times</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="n">marked_events_times_centered</span> <span class="o">=</span> <span class="n">marked_events_times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">-</span><span class="n">align_event_times</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_marked_events</span><span class="p">):</span>
                <span class="n">marked_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">trials_times</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">marked_events_times_centered</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

                <span class="n">trace_marker</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">trials_times</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">marked_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                    <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">cifToPlot</span><span class="p">[</span><span class="n">marked_index</span><span class="p">]],</span>
                    <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">marked_events_colors</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">symbol</span><span class="o">=</span><span class="n">marked_events_markers</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">size</span><span class="o">=</span><span class="n">marked_size</span><span class="p">),</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span>
                    <span class="n">legendgroup</span><span class="o">=</span><span class="s2">&quot;trial</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trials_ids</span><span class="p">[</span><span class="n">r</span><span class="p">]),</span>
                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_marker</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<span class="c1"># Lower bound</span>
<div class="viewcode-block" id="getPlotLowerBoundHist"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotLowerBoundHist">[docs]</a><span class="k">def</span> <span class="nf">getPlotLowerBoundHist</span><span class="p">(</span><span class="n">lowerBoundHist</span><span class="p">,</span> <span class="n">elapsedTimeHist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">xlabelIterNumber</span><span class="o">=</span><span class="s2">&quot;Iteration Number&quot;</span><span class="p">,</span>
                          <span class="n">xlabelElapsedTime</span><span class="o">=</span><span class="s2">&quot;Elapsed Time (sec)&quot;</span><span class="p">,</span>
                          <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Lower Bound&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">,</span>
                          <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">elapsedTimeHist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">lowerBoundHist</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;dash&quot;</span><span class="p">:</span> <span class="n">linestyle</span><span class="p">},</span>
            <span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="n">marker</span><span class="p">},</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xlabelIterNumber</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">elapsedTimeHist</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">lowerBoundHist</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;dash&quot;</span><span class="p">:</span> <span class="n">linestyle</span><span class="p">},</span>
            <span class="n">marker_symbol</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xlabelElapsedTime</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotLowerBoundVsOneParam"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotLowerBoundVsOneParam">[docs]</a><span class="k">def</span> <span class="nf">getPlotLowerBoundVsOneParam</span><span class="p">(</span><span class="n">paramValues</span><span class="p">,</span> <span class="n">lowerBoundValues</span><span class="p">,</span> <span class="n">refParams</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">yMin</span><span class="p">,</span> <span class="n">yMax</span><span class="p">,</span> <span class="n">lowerBoundLineColor</span><span class="p">,</span> <span class="n">refParamsLineColors</span><span class="p">,</span> <span class="n">percMargin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">xlab</span><span class="o">=</span><span class="s2">&quot;Parameter Value&quot;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s2">&quot;Lower Bound&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">yMin</span><span class="p">):</span>
        <span class="n">yMin</span> <span class="o">=</span> <span class="n">lowerBoundValues</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">yMax</span><span class="p">):</span>
        <span class="n">yMax</span> <span class="o">=</span> <span class="n">lowerBoundValues</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">margin</span> <span class="o">=</span> <span class="n">percMargin</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">yMin</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yMax</span><span class="p">))</span>
    <span class="n">yMin</span> <span class="o">=</span> <span class="n">yMin</span> <span class="o">-</span> <span class="n">margin</span>
    <span class="n">yMax</span> <span class="o">=</span> <span class="n">yMax</span> <span class="o">+</span> <span class="n">margin</span>

    <span class="n">layout</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s2">&quot;xaxis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">xlab</span><span class="p">},</span>
        <span class="c1"># &quot;yaxis&quot;: {&quot;title&quot;: &quot;Lower Bound&quot;},</span>
        <span class="s2">&quot;yaxis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">ylab</span><span class="p">,</span> <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">yMin</span><span class="p">,</span> <span class="n">yMax</span><span class="p">]},</span>
    <span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
            <span class="c1"># &quot;mode&quot;: &quot;markers&quot;,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">paramValues</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">lowerBoundValues</span><span class="p">,</span>
            <span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">lowerBoundLineColor</span><span class="p">),</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">lowerBoundLineColor</span><span class="p">),</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lower bound&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">refParams</span><span class="p">)):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span>
            <span class="c1"># Line Vertical</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
                <span class="n">x0</span><span class="o">=</span><span class="n">refParams</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">y0</span><span class="o">=</span><span class="n">yMin</span><span class="p">,</span>
                <span class="n">x1</span><span class="o">=</span><span class="n">refParams</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">y1</span><span class="o">=</span><span class="n">yMax</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">refParamsLineColors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">3</span>
                <span class="p">)</span>
        <span class="p">))</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="getPlotLowerBoundVsTwoParamsParam"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotLowerBoundVsTwoParamsParam">[docs]</a><span class="k">def</span> <span class="nf">getPlotLowerBoundVsTwoParamsParam</span><span class="p">(</span><span class="n">param1Values</span><span class="p">,</span>
                                      <span class="n">param2Values</span><span class="p">,</span>
                                      <span class="n">lowerBoundValues</span><span class="p">,</span>
                                      <span class="n">refParam1</span><span class="p">,</span>
                                      <span class="n">refParam2</span><span class="p">,</span>
                                      <span class="n">refParamsLowerBound</span><span class="p">,</span>
                                      <span class="n">refParamText</span><span class="p">,</span>
                                      <span class="n">title</span><span class="p">,</span>
                                      <span class="n">lowerBoundQuantile</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                                      <span class="n">param1Label</span><span class="o">=</span><span class="s2">&quot;Parameter 1&quot;</span><span class="p">,</span>
                                      <span class="n">param2Label</span><span class="o">=</span><span class="s2">&quot;Parameter 2&quot;</span><span class="p">,</span>
                                      <span class="n">lowerBoundLabel</span><span class="o">=</span><span class="s2">&quot;Lower Bound&quot;</span><span class="p">,</span>
                                      <span class="n">markerSize</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                                      <span class="n">markerOpacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                                      <span class="n">markerColorscale</span><span class="o">=</span><span class="s2">&quot;Viridis&quot;</span><span class="p">,</span>
                                      <span class="n">zMin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">param1Values</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">param2Values</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">lowerBoundValues</span><span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zMin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">zMin</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">lowerBoundQuantile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zMax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">zMax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">dfTrimmed</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">z</span><span class="o">&gt;</span><span class="n">zMin</span><span class="p">]</span>
    <span class="c1"># fig = go.Figure(data=[go.Scatter3d(x=param1Values, y=param2Values, z=lowerBoundValues, mode=&quot;markers&quot;)])</span>
<span class="c1">#     fig = go.Figure(data=[go.Scatter3d(x=dfTrimmed.x, y=dfTrimmed.y, z=dfTrimmed.z, mode=&quot;markers&quot;)])</span>
    <span class="c1"># fig.update_layout(scene=dict(zaxis=dict(range=[df.z.max()-1000,df.z.max()+500],)),width=700,)</span>
    <span class="c1"># fig = px.scatter_3d(dfTrimmed, x=&#39;x&#39;, y=&#39;y&#39;, z=&#39;z&#39;)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dfTrimmed</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">dfTrimmed</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                       <span class="n">z</span><span class="o">=</span><span class="n">dfTrimmed</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span>
                                       <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">markerSize</span><span class="p">,</span>
                                                   <span class="n">color</span><span class="o">=</span><span class="n">dfTrimmed</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                                                   <span class="n">colorscale</span><span class="o">=</span><span class="n">markerColorscale</span><span class="p">,</span>
                                                   <span class="n">opacity</span><span class="o">=</span><span class="n">markerOpacity</span><span class="p">))</span> <span class="p">])</span>

<span class="c1">#     fig = go.Figure(go.Mesh3d(x=dfTrimmed.x, y=dfTrimmed.y, z=dfTrimmed.z))</span>
<span class="c1">#     fig.add_trace(</span>
<span class="c1">#         go.Scatter3d(</span>
<span class="c1">#             x=[refParam1],</span>
<span class="c1">#             y=[refParam2],</span>
<span class="c1">#             z=[refParamsLowerBound],</span>
<span class="c1">#             type=&quot;scatter3d&quot;, text=[refParamText], mode=&quot;text&quot;,</span>
<span class="c1">#         )</span>
<span class="c1">#     )</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">scene</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">xaxis_title</span> <span class="o">=</span> <span class="n">param1Label</span><span class="p">,</span> <span class="n">yaxis_title</span> <span class="o">=</span> <span class="n">param2Label</span><span class="p">,</span> <span class="n">zaxis_title</span> <span class="o">=</span> <span class="n">lowerBoundLabel</span><span class="p">,))</span>
<span class="c1">#     fig.update_layout(scene = dict(zaxis = dict(range=[zMin,zMax]),))</span>
<span class="c1">#     fig.update_layout(scene = dict(zaxis=dict(range=[df.z.max()-1000,df.z.max()+500],),),)</span>
<span class="c1">#     pio.renderers.default = &quot;browser&quot;</span>
<span class="c1">#     fig.show()</span>
<span class="c1">#     pdb.set_trace()</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<span class="c1"># KS test</span>

<div class="viewcode-block" id="getPlotResKSTestTimeRescalingNumericalCorrection"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotResKSTestTimeRescalingNumericalCorrection">[docs]</a><span class="k">def</span> <span class="nf">getPlotResKSTestTimeRescalingNumericalCorrection</span><span class="p">(</span>
    <span class="n">diffECDFsX</span><span class="p">,</span> <span class="n">diffECDFsY</span><span class="p">,</span> <span class="n">estECDFx</span><span class="p">,</span> <span class="n">estECDFy</span><span class="p">,</span> <span class="n">simECDFx</span><span class="p">,</span> <span class="n">simECDFy</span><span class="p">,</span>
    <span class="n">cb</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">dataColor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">cbColor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">refColor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="n">estECDFcolor</span><span class="o">=</span><span class="s2">&quot;magenta&quot;</span><span class="p">,</span> <span class="n">simECDFcolor</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span>
    <span class="n">estECDFmarker</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">,</span> <span class="n">simECDFmarker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">dataLinestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">cbLinestyle</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span> <span class="n">refLinestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
    <span class="n">dataMarker</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Empirical Cumulative Distribution Function&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Rescaled Time&quot;</span><span class="p">,</span>
    <span class="n">diffLabel</span><span class="o">=</span><span class="s2">&quot;Difference&quot;</span><span class="p">,</span> <span class="n">estECDFlabel</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">,</span>
    <span class="n">simECDFlabel</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">trace_diff</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">diffECDFsX</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">diffECDFsY</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
                            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">dataColor</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="n">dataLinestyle</span><span class="p">),</span>
                            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">dataMarker</span><span class="p">),</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">diffLabel</span><span class="p">)</span>
    <span class="n">trace_est</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">estECDFx</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">estECDFy</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span>
                           <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">estECDFcolor</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="n">estECDFmarker</span><span class="p">),</span>
                           <span class="n">name</span><span class="o">=</span><span class="n">estECDFlabel</span><span class="p">)</span>
    <span class="n">trace_sim</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">simECDFx</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">simECDFy</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span>
                           <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">simECDFcolor</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="n">simECDFmarker</span><span class="p">),</span>
                           <span class="n">name</span><span class="o">=</span><span class="n">simECDFlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_diff</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_est</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_sim</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_hline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">refColor</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="n">refLinestyle</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_hline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">cb</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">cbColor</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="n">cbLinestyle</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_hline</span><span class="p">(</span><span class="n">y</span><span class="o">=-</span><span class="n">cb</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">cbColor</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="n">cbLinestyle</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

<span class="c1"># ROC analysis</span>

<div class="viewcode-block" id="getPlotResROCAnalysis"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotResROCAnalysis">[docs]</a><span class="k">def</span> <span class="nf">getPlotResROCAnalysis</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">colorROC</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                          <span class="n">colorRef</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyleROC</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
                          <span class="n">linestyleRef</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span>
                          <span class="n">labelPattern</span><span class="o">=</span><span class="s2">&quot;ROC curve (area=</span><span class="si">{:0.2f}</span><span class="s2">)&quot;</span><span class="p">,</span>
                          <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;False Positive Rate&quot;</span><span class="p">,</span>
                          <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;True Positive Rate&quot;</span><span class="p">,</span>
                          <span class="n">legendLoc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">line_ROC</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fpr</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">tpr</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
                          <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colorROC</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="n">linestyleROC</span><span class="p">),</span>
                          <span class="n">name</span><span class="o">=</span><span class="n">labelPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">auc</span><span class="p">))</span>
    <span class="n">line_ref</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                          <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colorRef</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="n">linestyleRef</span><span class="p">),</span>
                          <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">line_ROC</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">line_ref</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getPlotSmoothedSpikes"><a class="viewcode-back" href="../../../svGPFA.plot.html#svGPFA.plot.plotUtilsPlotly.getPlotSmoothedSpikes">[docs]</a><span class="k">def</span> <span class="nf">getPlotSmoothedSpikes</span><span class="p">(</span><span class="n">spikes_times</span><span class="p">,</span> <span class="n">gf_std_secs</span><span class="p">,</span>
                          <span class="n">epoch_start_offset</span><span class="p">,</span> <span class="n">epoch_end_offset</span><span class="p">,</span> <span class="n">bin_size_secs</span><span class="p">,</span>
                          <span class="n">neuron_to_plot_index</span><span class="p">,</span> <span class="n">trials_to_plot</span><span class="p">,</span> <span class="n">trials_colors</span><span class="p">,</span>
                          <span class="n">title</span><span class="p">):</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikes_times</span><span class="p">)</span>
    <span class="n">n_neurons</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikes_times</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">bins_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epoch_start_offset</span><span class="p">,</span> <span class="n">epoch_end_offset</span><span class="p">,</span> <span class="n">bin_size_secs</span><span class="p">)</span>
    <span class="n">bins_centers</span> <span class="o">=</span> <span class="p">(</span><span class="n">bins_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bins_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">binned_spikes_times</span> <span class="o">=</span> \
            <span class="n">gcnu_common</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">neuralDataAnalysis</span><span class="o">.</span><span class="n">binNeuronsAndTrialsSpikesTimes</span><span class="p">(</span>
                <span class="n">spikes_times</span><span class="o">=</span><span class="n">spikes_times</span><span class="p">,</span> <span class="n">bins_edges</span><span class="o">=</span><span class="n">bins_edges</span><span class="p">,</span>
                <span class="n">time_unit</span><span class="o">=</span><span class="s2">&quot;sec&quot;</span><span class="p">)</span>

    <span class="n">gf_std_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gf_std_secs</span> <span class="o">/</span> <span class="n">bin_size_secs</span><span class="p">)</span>
    <span class="n">gf_binned_spikes_times</span> <span class="o">=</span> \
        <span class="p">[[</span><span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">binned_spikes_times</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
                                          <span class="n">gf_std_samples</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_neurons</span><span class="p">)]</span>
         <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">)]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">trials_to_plot</span><span class="p">:</span>
        <span class="n">trace_color</span> <span class="o">=</span> <span class="n">trials_colors</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="n">trace_bar</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bins_centers</span><span class="p">,</span>
                           <span class="n">y</span><span class="o">=</span><span class="n">binned_spikes_times</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">neuron_to_plot_index</span><span class="p">],</span>
                           <span class="n">marker_color</span><span class="o">=</span><span class="n">trace_color</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trial </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
                           <span class="n">legendgroup</span><span class="o">=</span><span class="s2">&quot;trial</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
                           <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_bar</span><span class="p">)</span>
        <span class="n">trace_line</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bins_centers</span><span class="p">,</span>
                                <span class="n">y</span><span class="o">=</span><span class="n">gf_binned_spikes_times</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">neuron_to_plot_index</span><span class="p">],</span>
                                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">trace_color</span><span class="p">),</span>
                                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trial </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
                                <span class="n">legendgroup</span><span class="o">=</span><span class="s2">&quot;trial</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
                                <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace_line</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>

</pre></div>

  </article>

  <footer>
    
      <div class="mt-20 mb-4 text-sm text-gray-700 print:mt-4">&copy; 2019, Lea Duncker and Maneesh Sahani&nbsp;Made with <a href="https://www.sphinx-doc.org">Sphinx 6.1.3</a></div>
    
  </footer></main>


      <button
  data-search-target="snackbar"
  data-action="search#hideSnackbar"
  class="fixed bottom-0 right-0 z-20 opacity-0 p-4 m-4 tracking-wide bg-gray-900 text-gray-100 transition transform transform-gpu duration-500 translate-y-full"
>
  Clear highlights
</button><div
  data-sidebar-target="screen"
  data-action="click->sidebar#close"
  class="fixed hidden inset-0 bg-black bg-opacity-50">
</div>
    </div>
    
      
<script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
<script src="../../../_static/doctools.js"></script>
<script src="../../../_static/sphinx_highlight.js"></script>
<script src="../../../_static/proof.js"></script>
<script src="../../../_static/theme.b62e1ded0c8c099a2d47.js"></script>
    
  </body>
</html>